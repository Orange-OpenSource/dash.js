{"version":3,"file":"dash.reporting.min.js","sourceRoot":"./src/","sources":["..\\node_modules\\browserify\\node_modules\\browser-pack\\_prelude.js","core\\FactoryMaker.js","core\\events\\EventsBase.js","streaming\\constants\\Constants.js","streaming\\metrics\\MetricsReporting.js","streaming\\metrics\\MetricsReportingEvents.js","streaming\\metrics\\controllers\\MetricsCollectionController.js","streaming\\metrics\\controllers\\MetricsController.js","streaming\\metrics\\controllers\\MetricsHandlersController.js","streaming\\metrics\\controllers\\RangeController.js","streaming\\metrics\\controllers\\ReportingController.js","streaming\\metrics\\metrics\\MetricsHandlerFactory.js","streaming\\metrics\\metrics\\handlers\\BufferLevelHandler.js","streaming\\metrics\\metrics\\handlers\\DVBErrorsHandler.js","streaming\\metrics\\metrics\\handlers\\GenericMetricHandler.js","streaming\\metrics\\metrics\\handlers\\HttpListHandler.js","streaming\\metrics\\reporting\\ReportingFactory.js","streaming\\metrics\\reporting\\reporters\\DVBReporting.js","streaming\\metrics\\utils\\DVBErrorsTranslator.js","streaming\\metrics\\utils\\HandlerHelpers.js","streaming\\metrics\\utils\\ManifestParsing.js","streaming\\metrics\\utils\\MetricSerialiser.js","streaming\\metrics\\utils\\RNG.js","streaming\\metrics\\vo\\DVBErrors.js","streaming\\metrics\\vo\\Metrics.js","streaming\\metrics\\vo\\Range.js","streaming\\metrics\\vo\\Reporting.js","streaming\\utils\\CustomTimeRanges.js","streaming\\utils\\SupervisorTools.js"],"sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @module FactoryMaker\r\n * @ignore\r\n */\r\nconst FactoryMaker = (function () {\r\n\r\n    let instance;\r\n    const singletonContexts = [];\r\n    const singletonFactories = {};\r\n    const classFactories = {};\r\n\r\n    function extend(name, childInstance, override, context) {\r\n        if (!context[name] && childInstance) {\r\n            context[name] = {\r\n                instance: childInstance,\r\n                override: override\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Use this method from your extended object.  this.factory is injected into your object.\r\n     * this.factory.getSingletonInstance(this.context, 'VideoModel')\r\n     * will return the video model for use in the extended object.\r\n     *\r\n     * @param {Object} context - injected into extended object as this.context\r\n     * @param {string} className - string name found in all dash.js objects\r\n     * with name __dashjs_factory_name Will be at the bottom. Will be the same as the object's name.\r\n     * @returns {*} Context aware instance of specified singleton name.\r\n     * @memberof module:FactoryMaker\r\n     * @instance\r\n     */\r\n    function getSingletonInstance(context, className) {\r\n        for (const i in singletonContexts) {\r\n            const obj = singletonContexts[i];\r\n            if (obj.context === context && obj.name === className) {\r\n                return obj.instance;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Use this method to add an singleton instance to the system.  Useful for unit testing to mock objects etc.\r\n     *\r\n     * @param {Object} context\r\n     * @param {string} className\r\n     * @param {Object} instance\r\n     * @memberof module:FactoryMaker\r\n     * @instance\r\n     */\r\n    function setSingletonInstance(context, className, instance) {\r\n        for (const i in singletonContexts) {\r\n            const obj = singletonContexts[i];\r\n            if (obj.context === context && obj.name === className) {\r\n                singletonContexts[i].instance = instance;\r\n                return;\r\n            }\r\n        }\r\n        singletonContexts.push({\r\n            name: className,\r\n            context: context,\r\n            instance: instance\r\n        });\r\n    }\r\n\r\n    /*------------------------------------------------------------------------------------------*/\r\n\r\n    // Factories storage Management\r\n\r\n    /*------------------------------------------------------------------------------------------*/\r\n\r\n    function getFactoryByName(name, factoriesArray) {\r\n        return factoriesArray[name];\r\n    }\r\n\r\n    function updateFactory(name, factory, factoriesArray) {\r\n        if (name in factoriesArray) {\r\n            factoriesArray[name] = factory;\r\n        }\r\n    }\r\n\r\n    /*------------------------------------------------------------------------------------------*/\r\n\r\n    // Class Factories Management\r\n\r\n    /*------------------------------------------------------------------------------------------*/\r\n\r\n    function updateClassFactory(name, factory) {\r\n        updateFactory(name, factory, classFactories);\r\n    }\r\n\r\n    function getClassFactoryByName(name) {\r\n        return getFactoryByName(name, classFactories);\r\n    }\r\n\r\n    function getClassFactory(classConstructor) {\r\n        let factory = getFactoryByName(classConstructor.__dashjs_factory_name, classFactories);\r\n\r\n        if (!factory) {\r\n            factory = function (context) {\r\n                if (context === undefined) {\r\n                    context = {};\r\n                }\r\n                return {\r\n                    create: function () {\r\n                        return merge(classConstructor, context, arguments);\r\n                    }\r\n                };\r\n            };\r\n\r\n            classFactories[classConstructor.__dashjs_factory_name] = factory; // store factory\r\n        }\r\n        return factory;\r\n    }\r\n\r\n    /*------------------------------------------------------------------------------------------*/\r\n\r\n    // Singleton Factory MAangement\r\n\r\n    /*------------------------------------------------------------------------------------------*/\r\n\r\n    function updateSingletonFactory(name, factory) {\r\n        updateFactory(name, factory, singletonFactories);\r\n    }\r\n\r\n    function getSingletonFactoryByName(name) {\r\n        return getFactoryByName(name, singletonFactories);\r\n    }\r\n\r\n    function getSingletonFactory(classConstructor) {\r\n        let factory = getFactoryByName(classConstructor.__dashjs_factory_name, singletonFactories);\r\n        if (!factory) {\r\n            factory = function (context) {\r\n                let instance;\r\n                if (context === undefined) {\r\n                    context = {};\r\n                }\r\n                return {\r\n                    getInstance: function () {\r\n                        // If we don't have an instance yet check for one on the context\r\n                        if (!instance) {\r\n                            instance = getSingletonInstance(context, classConstructor.__dashjs_factory_name);\r\n                        }\r\n                        // If there's no instance on the context then create one\r\n                        if (!instance) {\r\n                            instance = merge(classConstructor, context, arguments);\r\n                            singletonContexts.push({\r\n                                name: classConstructor.__dashjs_factory_name,\r\n                                context: context,\r\n                                instance: instance\r\n                            });\r\n                        }\r\n                        return instance;\r\n                    }\r\n                };\r\n            };\r\n            singletonFactories[classConstructor.__dashjs_factory_name] = factory; // store factory\r\n        }\r\n\r\n        return factory;\r\n    }\r\n\r\n    function merge(classConstructor, context, args) {\r\n\r\n        let classInstance;\r\n        const className = classConstructor.__dashjs_factory_name;\r\n        const extensionObject = context[className];\r\n\r\n        if (extensionObject) {\r\n\r\n            let extension = extensionObject.instance;\r\n\r\n            if (extensionObject.override) { //Override public methods in parent but keep parent.\r\n\r\n                classInstance = classConstructor.apply({context}, args);\r\n                extension = extension.apply({\r\n                    context,\r\n                    factory: instance,\r\n                    parent: classInstance\r\n                }, args);\r\n\r\n                for (const prop in extension) {\r\n                    if (classInstance.hasOwnProperty(prop)) {\r\n                        classInstance[prop] = extension[prop];\r\n                    }\r\n                }\r\n\r\n            } else { //replace parent object completely with new object. Same as dijon.\r\n\r\n                return extension.apply({\r\n                    context,\r\n                    factory: instance\r\n                }, args);\r\n\r\n            }\r\n        } else {\r\n            // Create new instance of the class\r\n            classInstance = classConstructor.apply({context}, args);\r\n        }\r\n\r\n        // Add getClassName function to class instance prototype (used by Debug)\r\n        classInstance.getClassName = function () {return className;};\r\n\r\n        return classInstance;\r\n    }\r\n\r\n    instance = {\r\n        extend: extend,\r\n        getSingletonInstance: getSingletonInstance,\r\n        setSingletonInstance: setSingletonInstance,\r\n        getSingletonFactory: getSingletonFactory,\r\n        getSingletonFactoryByName: getSingletonFactoryByName,\r\n        updateSingletonFactory: updateSingletonFactory,\r\n        getClassFactory: getClassFactory,\r\n        getClassFactoryByName: getClassFactoryByName,\r\n        updateClassFactory: updateClassFactory\r\n    };\r\n\r\n    return instance;\r\n\r\n}());\r\n\r\nexport default FactoryMaker;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @class\r\n * @ignore\r\n */\r\nclass EventsBase {\r\n    extend (events, config) {\r\n        if (!events) return;\r\n\r\n        let override = config ? config.override : false;\r\n        let publicOnly = config ? config.publicOnly : false;\r\n\r\n\r\n        for (const evt in events) {\r\n            if (!events.hasOwnProperty(evt) || (this[evt] && !override)) continue;\r\n            if (publicOnly && events[evt].indexOf('public_') === -1) continue;\r\n            this[evt] = events[evt];\r\n\r\n        }\r\n    }\r\n}\r\n\r\nexport default EventsBase;","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n/**\r\n * Constants declaration\r\n * @class\r\n * @ignore\r\n * @hideconstructor\r\n */\r\nclass Constants {\r\n\r\n    init () {\r\n        /**\r\n         *  @constant {string} STREAM Stream media type. Mainly used to report metrics relative to the full stream\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.STREAM = 'stream';\r\n\r\n        /**\r\n         *  @constant {string} VIDEO Video media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.VIDEO = 'video';\r\n\r\n        /**\r\n         *  @constant {string} AUDIO Audio media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.AUDIO = 'audio';\r\n\r\n        /**\r\n         *  @constant {string} TEXT Text media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.TEXT = 'text';\r\n\r\n        /**\r\n         *  @constant {string} FRAGMENTED_TEXT Fragmented text media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.FRAGMENTED_TEXT = 'fragmentedText';\r\n\r\n        /**\r\n         *  @constant {string} EMBEDDED_TEXT Embedded text media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.EMBEDDED_TEXT = 'embeddedText';\r\n\r\n        /**\r\n         *  @constant {string} MUXED Muxed (video/audio in the same chunk) media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.MUXED = 'muxed';\r\n\r\n        /**\r\n         *  @constant {string} IMAGE Image media type\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.IMAGE = 'image';\r\n\r\n        /**\r\n         *  @constant {string} STPP STTP Subtitles format\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.STPP = 'stpp';\r\n\r\n        /**\r\n         *  @constant {string} TTML STTP Subtitles format\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.TTML = 'ttml';\r\n\r\n        /**\r\n         *  @constant {string} VTT STTP Subtitles format\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.VTT = 'vtt';\r\n\r\n        /**\r\n         *  @constant {string} WVTT STTP Subtitles format\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.WVTT = 'wvtt';\r\n\r\n        /**\r\n         *  @constant {string} ABR_STRATEGY_DYNAMIC Dynamic Adaptive bitrate algorithm\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.ABR_STRATEGY_DYNAMIC = 'abrDynamic';\r\n\r\n        /**\r\n         *  @constant {string} ABR_STRATEGY_BOLA Adaptive bitrate algorithm based on Bola (buffer level)\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.ABR_STRATEGY_BOLA = 'abrBola';\r\n\r\n        /**\r\n         *  @constant {string} ABR_STRATEGY_THROUGHPUT Adaptive bitrate algorithm based on throughput\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.ABR_STRATEGY_THROUGHPUT = 'abrThroughput';\r\n\r\n        /**\r\n         *  @constant {string} MOVING_AVERAGE_SLIDING_WINDOW Moving average sliding window\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.MOVING_AVERAGE_SLIDING_WINDOW = 'slidingWindow';\r\n\r\n        /**\r\n         *  @constant {string} EWMA Exponential moving average\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.MOVING_AVERAGE_EWMA = 'ewma';\r\n\r\n        /**\r\n         *  @constant {string} BAD_ARGUMENT_ERROR Invalid Arguments type of error\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.BAD_ARGUMENT_ERROR = 'Invalid Arguments';\r\n\r\n        /**\r\n         *  @constant {string} MISSING_CONFIG_ERROR Missing configuration parameters type of error\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.MISSING_CONFIG_ERROR = 'Missing config parameter(s)';\r\n\r\n        /**\r\n         *  @constant {string} TRACK_SWITCH_MODE_ALWAYS_REPLACE used to clear the buffered data (prior to current playback position) after track switch. Default for audio\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.TRACK_SWITCH_MODE_ALWAYS_REPLACE = 'alwaysReplace';\r\n\r\n        /**\r\n         *  @constant {string} TRACK_SWITCH_MODE_NEVER_REPLACE used to forbid clearing the buffered data (prior to current playback position) after track switch. Defers to fastSwitchEnabled for placement of new data. Default for video\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.TRACK_SWITCH_MODE_NEVER_REPLACE = 'neverReplace';\r\n\r\n        /**\r\n         *  @constant {string} TRACK_SELECTION_MODE_HIGHEST_BITRATE makes the player select the track with a highest bitrate. This mode is a default mode.\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.TRACK_SELECTION_MODE_HIGHEST_BITRATE = 'highestBitrate';\r\n\r\n        /**\r\n         *  @constant {string} TRACK_SELECTION_MODE_WIDEST_RANGE this mode makes the player select the track with a widest range of bitrates\r\n         *  @memberof Constants#\r\n         *  @static\r\n         */\r\n        this.TRACK_SELECTION_MODE_WIDEST_RANGE = 'widestRange';\r\n\r\n        this.LOCATION = 'Location';\r\n        this.INITIALIZE = 'initialize';\r\n        this.TEXT_SHOWING = 'showing';\r\n        this.TEXT_HIDDEN = 'hidden';\r\n        this.CC1 = 'CC1';\r\n        this.CC3 = 'CC3';\r\n        this.UTF8 = 'utf-8';\r\n        this.SCHEME_ID_URI = 'schemeIdUri';\r\n        this.START_TIME = 'starttime';\r\n        this.SERVICE_DESCRIPTION_LL_SCHEME = 'urn:dvb:dash:lowlatency:scope:2019';\r\n        this.SUPPLEMENTAL_PROPERTY_LL_SCHEME = 'urn:dvb:dash:lowlatency:critical:2019';\r\n        this.XML = 'XML';\r\n        this.ARRAY_BUFFER = 'ArrayBuffer';\r\n    }\r\n\r\n    constructor () {\r\n        this.init();\r\n    }\r\n}\r\n\r\nconst constants = new Constants();\r\nexport default constants;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport DVBErrorsTranslator from './utils/DVBErrorsTranslator';\r\nimport MetricsReportingEvents from './MetricsReportingEvents';\r\nimport MetricsCollectionController from './controllers/MetricsCollectionController';\r\nimport MetricsHandlerFactory from './metrics/MetricsHandlerFactory';\r\nimport ReportingFactory from './reporting/ReportingFactory';\r\n\r\nfunction MetricsReporting() {\r\n\r\n    let context = this.context;\r\n    let instance,\r\n        dvbErrorsTranslator;\r\n\r\n    /**\r\n     * Create a MetricsCollectionController, and a DVBErrorsTranslator\r\n     * @param {Object} config - dependancies from owner\r\n     * @return {MetricsCollectionController} Metrics Collection Controller\r\n     */\r\n    function createMetricsReporting(config) {\r\n        dvbErrorsTranslator = DVBErrorsTranslator(context).getInstance({\r\n            eventBus: config.eventBus,\r\n            dashMetrics: config.dashMetrics,\r\n            metricsConstants: config.metricsConstants,\r\n            events: config.events\r\n        });\r\n\r\n        return MetricsCollectionController(context).create(config);\r\n    }\r\n\r\n    /**\r\n     * Get the ReportingFactory to allow new reporters to be registered\r\n     * @return {ReportingFactory} Reporting Factory\r\n     */\r\n    function getReportingFactory() {\r\n        return ReportingFactory(context).getInstance();\r\n    }\r\n\r\n    /**\r\n     * Get the MetricsHandlerFactory to allow new handlers to be registered\r\n     * @return {MetricsHandlerFactory} Metrics Handler Factory\r\n     */\r\n    function getMetricsHandlerFactory() {\r\n        return MetricsHandlerFactory(context).getInstance();\r\n    }\r\n\r\n    instance = {\r\n        createMetricsReporting:     createMetricsReporting,\r\n        getReportingFactory:        getReportingFactory,\r\n        getMetricsHandlerFactory:   getMetricsHandlerFactory\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nMetricsReporting.__dashjs_factory_name = 'MetricsReporting';\r\nconst factory = dashjs.FactoryMaker.getClassFactory(MetricsReporting); /* jshint ignore:line */\r\nfactory.events = MetricsReportingEvents;\r\ndashjs.FactoryMaker.updateClassFactory(MetricsReporting.__dashjs_factory_name, factory); /* jshint ignore:line */\r\nexport default factory;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\nimport EventsBase from '../../core/events/EventsBase';\r\n\r\nclass MetricsReportingEvents extends EventsBase {\r\n    constructor () {\r\n        super();\r\n\r\n        this.METRICS_INITIALISATION_COMPLETE = 'internal_metricsReportingInitialized';\r\n        this.BECAME_REPORTING_PLAYER = 'internal_becameReportingPlayer';\r\n\r\n        /**\r\n         * Triggered when CMCD data was generated for a HTTP request\r\n         * @event MetricsReportingEvents#CMCD_DATA_GENERATED\r\n         */\r\n        this.CMCD_DATA_GENERATED = 'cmcdDataGenerated';\r\n    }\r\n}\r\n\r\nlet metricsReportingEvents = new MetricsReportingEvents();\r\nexport default metricsReportingEvents;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport MetricsController from './MetricsController';\r\nimport ManifestParsing from '../utils/ManifestParsing';\r\nimport MetricsReportingEvents from '../MetricsReportingEvents';\r\n\r\nfunction MetricsCollectionController(config) {\r\n\r\n    config = config || {};\r\n    let instance;\r\n    let metricsControllers = {};\r\n    let context = this.context;\r\n    let eventBus = config.eventBus;\r\n    const events = config.events;\r\n\r\n    function update(e) {\r\n        if (e.error) {\r\n            return;\r\n        }\r\n\r\n        // start by assuming all existing controllers need removing\r\n        let controllersToRemove = Object.keys(metricsControllers);\r\n\r\n        const metrics = ManifestParsing(context).getInstance({\r\n            adapter: config.adapter,\r\n            constants: config.constants\r\n        }).getMetrics(e.manifest);\r\n\r\n        metrics.forEach(m => {\r\n            const key = JSON.stringify(m);\r\n\r\n            if (!metricsControllers.hasOwnProperty(key)) {\r\n                try {\r\n                    let controller = MetricsController(context).create(config);\r\n                    controller.initialize(m);\r\n                    metricsControllers[key] = controller;\r\n                } catch (e) {\r\n                    // fail quietly\r\n                }\r\n            } else {\r\n                // we still need this controller - delete from removal list\r\n                controllersToRemove.splice(key, 1);\r\n            }\r\n        });\r\n\r\n        // now remove the unwanted controllers\r\n        controllersToRemove.forEach(c => {\r\n            metricsControllers[c].reset();\r\n            delete metricsControllers[c];\r\n        });\r\n\r\n        eventBus.trigger(MetricsReportingEvents.METRICS_INITIALISATION_COMPLETE);\r\n    }\r\n\r\n    function resetMetricsControllers() {\r\n        Object.keys(metricsControllers).forEach(key => {\r\n            metricsControllers[key].reset();\r\n        });\r\n\r\n        metricsControllers = {};\r\n    }\r\n\r\n    function setup() {\r\n        eventBus.on(events.MANIFEST_UPDATED, update, instance);\r\n        eventBus.on(events.STREAM_TEARDOWN_COMPLETE, resetMetricsControllers, instance);\r\n    }\r\n\r\n    function reset() {\r\n        eventBus.off(events.MANIFEST_UPDATED, update, instance);\r\n        eventBus.off(events.STREAM_TEARDOWN_COMPLETE, resetMetricsControllers, instance);\r\n    }\r\n\r\n    instance = {\r\n        reset: reset\r\n    };\r\n\r\n    setup();\r\n    return instance;\r\n}\r\n\r\nMetricsCollectionController.__dashjs_factory_name = 'MetricsCollectionController';\r\nexport default dashjs.FactoryMaker.getClassFactory(MetricsCollectionController); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport RangeController from './RangeController';\r\nimport ReportingController from './ReportingController';\r\nimport MetricsHandlersController from './MetricsHandlersController';\r\n\r\nfunction MetricsController(config) {\r\n\r\n    config = config || {};\r\n    let metricsHandlersController,\r\n        reportingController,\r\n        rangeController,\r\n        instance;\r\n\r\n    let context = this.context;\r\n\r\n    function initialize(metricsEntry) {\r\n        try {\r\n            rangeController = RangeController(context).create({\r\n                mediaElement: config.mediaElement\r\n            });\r\n\r\n            rangeController.initialize(metricsEntry.Range);\r\n\r\n            reportingController = ReportingController(context).create({\r\n                debug: config.debug,\r\n                metricsConstants: config.metricsConstants\r\n            });\r\n\r\n            reportingController.initialize(metricsEntry.Reporting, rangeController);\r\n\r\n            metricsHandlersController = MetricsHandlersController(context).create({\r\n                debug: config.debug,\r\n                eventBus: config.eventBus,\r\n                metricsConstants: config.metricsConstants,\r\n                events: config.events\r\n            });\r\n\r\n            metricsHandlersController.initialize(metricsEntry.metrics, reportingController);\r\n        } catch (e) {\r\n            reset();\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    function reset() {\r\n        if (metricsHandlersController) {\r\n            metricsHandlersController.reset();\r\n        }\r\n\r\n        if (reportingController) {\r\n            reportingController.reset();\r\n        }\r\n\r\n        if (rangeController) {\r\n            rangeController.reset();\r\n        }\r\n    }\r\n\r\n    instance = {\r\n        initialize: initialize,\r\n        reset:      reset\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nMetricsController.__dashjs_factory_name = 'MetricsController';\r\nexport default dashjs.FactoryMaker.getClassFactory(MetricsController); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport MetricsHandlerFactory from '../metrics/MetricsHandlerFactory';\r\n\r\nfunction MetricsHandlersController(config) {\r\n\r\n    config = config || {};\r\n    let handlers = [];\r\n\r\n    let instance;\r\n    const context = this.context;\r\n    const eventBus = config.eventBus;\r\n    const Events = config.events;\r\n\r\n    let metricsHandlerFactory = MetricsHandlerFactory(context).getInstance({\r\n        debug: config.debug,\r\n        eventBus: config.eventBus,\r\n        metricsConstants: config.metricsConstants\r\n    });\r\n\r\n    function handle(e) {\r\n        handlers.forEach(handler => {\r\n            handler.handleNewMetric(e.metric, e.value, e.mediaType);\r\n        });\r\n    }\r\n\r\n    function initialize(metrics, reportingController) {\r\n        metrics.split(',').forEach(\r\n            (m, midx, ms) => {\r\n                let handler;\r\n\r\n                // there is a bug in ISO23009-1 where the metrics attribute\r\n                // is a comma-separated list but HttpList key can contain a\r\n                // comma enclosed by ().\r\n                if ((m.indexOf('(') !== -1) && m.indexOf(')') === -1) {\r\n                    let nextm = ms[midx + 1];\r\n\r\n                    if (nextm &&\r\n                            (nextm.indexOf('(') === -1) &&\r\n                            (nextm.indexOf(')') !== -1)) {\r\n                        m += ',' + nextm;\r\n\r\n                        // delete the next metric so forEach does not visit.\r\n                        delete ms[midx + 1];\r\n                    }\r\n                }\r\n\r\n                handler = metricsHandlerFactory.create(\r\n                    m,\r\n                    reportingController\r\n                );\r\n\r\n                if (handler) {\r\n                    handlers.push(handler);\r\n                }\r\n            }\r\n        );\r\n\r\n        eventBus.on(\r\n            Events.METRIC_ADDED,\r\n            handle,\r\n            instance\r\n        );\r\n\r\n        eventBus.on(\r\n            Events.METRIC_UPDATED,\r\n            handle,\r\n            instance\r\n        );\r\n    }\r\n\r\n    function reset() {\r\n        eventBus.off(\r\n            Events.METRIC_ADDED,\r\n            handle,\r\n            instance\r\n        );\r\n\r\n        eventBus.off(\r\n            Events.METRIC_UPDATED,\r\n            handle,\r\n            instance\r\n        );\r\n\r\n        handlers.forEach(handler => handler.reset());\r\n\r\n        handlers = [];\r\n    }\r\n\r\n    instance = {\r\n        initialize: initialize,\r\n        reset:      reset\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nMetricsHandlersController.__dashjs_factory_name = 'MetricsHandlersController';\r\nexport default dashjs.FactoryMaker.getClassFactory(MetricsHandlersController); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport CustomTimeRanges from '../../utils/CustomTimeRanges';\r\n\r\nfunction RangeController(config) {\r\n\r\n    config = config || {};\r\n    let useWallClockTime = false;\r\n    let context = this.context;\r\n    let instance,\r\n        ranges;\r\n\r\n    let mediaElement = config.mediaElement;\r\n\r\n    function initialize(rs) {\r\n        if (rs && rs.length) {\r\n            rs.forEach(r => {\r\n                let start = r.starttime;\r\n                let end = start + r.duration;\r\n\r\n                ranges.add(start, end);\r\n            });\r\n\r\n            useWallClockTime = !!rs[0]._useWallClockTime;\r\n        }\r\n    }\r\n\r\n    function reset() {\r\n        ranges.clear();\r\n    }\r\n\r\n    function setup() {\r\n        ranges = CustomTimeRanges(context).create();\r\n    }\r\n\r\n    function isEnabled() {\r\n        let numRanges = ranges.length;\r\n        let time;\r\n\r\n        if (!numRanges) {\r\n            return true;\r\n        }\r\n\r\n        // When not present, DASH Metrics reporting is requested\r\n        // for the whole duration of the content.\r\n        time = useWallClockTime ?\r\n                (new Date().getTime() / 1000) :\r\n                mediaElement.currentTime;\r\n\r\n        for (let i = 0; i < numRanges; i += 1) {\r\n            let start = ranges.start(i);\r\n            let end = ranges.end(i);\r\n\r\n            if ((start <= time) && (time < end)) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    instance = {\r\n        initialize: initialize,\r\n        reset:      reset,\r\n        isEnabled:  isEnabled\r\n    };\r\n\r\n    setup();\r\n\r\n    return instance;\r\n}\r\n\r\nRangeController.__dashjs_factory_name = 'RangeController';\r\nexport default dashjs.FactoryMaker.getClassFactory(RangeController); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport ReportingFactory from '../reporting/ReportingFactory';\r\n\r\nfunction ReportingController(config) {\r\n\r\n    let reporters = [];\r\n    let instance;\r\n\r\n    const reportingFactory = ReportingFactory(this.context).getInstance(config);\r\n\r\n    function initialize(reporting, rangeController) {\r\n        // \"if multiple Reporting elements are present, it is expected that\r\n        // the client processes one of the recognized reporting schemes.\"\r\n        // to ignore this, and support multiple Reporting per Metric,\r\n        // simply change the 'some' below to 'forEach'\r\n        reporting.some(r => {\r\n            let reporter = reportingFactory.create(r, rangeController);\r\n\r\n            if (reporter) {\r\n                reporters.push(reporter);\r\n                return true;\r\n            }\r\n        });\r\n    }\r\n\r\n    function reset() {\r\n        reporters.forEach(r => r.reset());\r\n        reporters = [];\r\n    }\r\n\r\n    function report(type, vos) {\r\n        reporters.forEach(r => r.report(type, vos));\r\n    }\r\n\r\n    instance = {\r\n        initialize: initialize,\r\n        reset:      reset,\r\n        report:     report\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nReportingController.__dashjs_factory_name = 'ReportingController';\r\nexport default dashjs.FactoryMaker.getClassFactory(ReportingController); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport BufferLevel from './handlers/BufferLevelHandler';\r\nimport DVBErrors from './handlers/DVBErrorsHandler';\r\nimport HttpList from './handlers/HttpListHandler';\r\nimport GenericMetricHandler from './handlers/GenericMetricHandler';\r\n\r\nfunction MetricsHandlerFactory(config) {\r\n\r\n    config = config || {};\r\n    let instance;\r\n    const logger = config.debug ? config.debug.getLogger(instance) : {};\r\n\r\n    // group 1: key, [group 3: n [, group 5: type]]\r\n    let keyRegex = /([a-zA-Z]*)(\\(([0-9]*)(\\,\\s*([a-zA-Z]*))?\\))?/;\r\n\r\n    const context = this.context;\r\n    let knownFactoryProducts = {\r\n        BufferLevel:    BufferLevel,\r\n        DVBErrors:      DVBErrors,\r\n        HttpList:       HttpList,\r\n        PlayList:       GenericMetricHandler,\r\n        RepSwitchList:  GenericMetricHandler,\r\n        TcpList:        GenericMetricHandler\r\n    };\r\n\r\n    function create(listType, reportingController) {\r\n        var matches = listType.match(keyRegex);\r\n        var handler;\r\n\r\n        if (!matches) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            handler = knownFactoryProducts[matches[1]](context).create({\r\n                eventBus: config.eventBus,\r\n                metricsConstants: config.metricsConstants\r\n            });\r\n\r\n            handler.initialize(\r\n                matches[1],\r\n                reportingController,\r\n                matches[3],\r\n                matches[5]\r\n            );\r\n        } catch (e) {\r\n            handler = null;\r\n            logger.error(`MetricsHandlerFactory: Could not create handler for type ${matches[1]} with args ${matches[3]}, ${matches[5]} (${e.message})`);\r\n        }\r\n\r\n        return handler;\r\n    }\r\n\r\n    function register(key, handler) {\r\n        knownFactoryProducts[key] = handler;\r\n    }\r\n\r\n    function unregister(key) {\r\n        delete knownFactoryProducts[key];\r\n    }\r\n\r\n    instance = {\r\n        create:     create,\r\n        register:   register,\r\n        unregister: unregister\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nMetricsHandlerFactory.__dashjs_factory_name = 'MetricsHandlerFactory';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(MetricsHandlerFactory); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport HandlerHelpers from '../../utils/HandlerHelpers';\r\n\r\nfunction BufferLevelHandler(config) {\r\n\r\n    config = config || {};\r\n    let instance,\r\n        reportingController,\r\n        n,\r\n        name,\r\n        interval,\r\n        lastReportedTime;\r\n\r\n    let context = this.context;\r\n    let handlerHelpers = HandlerHelpers(context).getInstance();\r\n\r\n    let storedVOs = [];\r\n\r\n    const metricsConstants = config.metricsConstants;\r\n\r\n    function getLowestBufferLevelVO() {\r\n        try {\r\n            return Object.keys(storedVOs).map(\r\n                key => storedVOs[key]\r\n            ).reduce(\r\n                (a, b) => {\r\n                    return (a.level < b.level) ? a : b;\r\n                }\r\n            );\r\n        } catch (e) {\r\n            return;\r\n        }\r\n    }\r\n\r\n    function intervalCallback() {\r\n        let vo = getLowestBufferLevelVO();\r\n\r\n        if (vo) {\r\n            if (lastReportedTime !== vo.t) {\r\n                lastReportedTime = vo.t;\r\n                reportingController.report(name, vo);\r\n            }\r\n        }\r\n    }\r\n\r\n    function initialize(basename, rc, n_ms) {\r\n        if (rc) {\r\n            // this will throw if n is invalid, to be\r\n            // caught by the initialize caller.\r\n            n = handlerHelpers.validateN(n_ms);\r\n            reportingController = rc;\r\n            name = handlerHelpers.reconstructFullMetricName(basename, n_ms);\r\n            interval = setInterval(intervalCallback, n);\r\n        }\r\n    }\r\n\r\n    function reset() {\r\n        clearInterval(interval);\r\n        interval = null;\r\n        n = 0;\r\n        reportingController = null;\r\n        lastReportedTime = null;\r\n    }\r\n\r\n    function handleNewMetric(metric, vo, type) {\r\n        if (metric === metricsConstants.BUFFER_LEVEL) {\r\n            storedVOs[type] = vo;\r\n        }\r\n    }\r\n\r\n    instance = {\r\n        initialize:         initialize,\r\n        reset:              reset,\r\n        handleNewMetric:    handleNewMetric\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nBufferLevelHandler.__dashjs_factory_name = 'BufferLevelHandler';\r\nexport default dashjs.FactoryMaker.getClassFactory(BufferLevelHandler); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport MetricsReportingEvents from '../../MetricsReportingEvents';\r\n\r\nfunction DVBErrorsHandler(config) {\r\n\r\n    config = config || {};\r\n    let instance,\r\n        reportingController;\r\n\r\n    let eventBus = config.eventBus;\r\n    const metricsConstants = config.metricsConstants;\r\n\r\n    function onInitialisationComplete() {\r\n        // we only want to report this once per call to initialize\r\n        eventBus.off(\r\n            MetricsReportingEvents.METRICS_INITIALISATION_COMPLETE,\r\n            onInitialisationComplete,\r\n            this\r\n        );\r\n\r\n        // Note: A Player becoming a reporting Player is itself\r\n        // something which is recorded by the DVBErrors metric.\r\n        eventBus.trigger(MetricsReportingEvents.BECAME_REPORTING_PLAYER);\r\n    }\r\n\r\n    function initialize(unused, rc) {\r\n        if (rc) {\r\n            reportingController = rc;\r\n\r\n            eventBus.on(\r\n                MetricsReportingEvents.METRICS_INITIALISATION_COMPLETE,\r\n                onInitialisationComplete,\r\n                this\r\n            );\r\n        }\r\n    }\r\n\r\n    function reset() {\r\n        reportingController = null;\r\n    }\r\n\r\n    function handleNewMetric(metric, vo) {\r\n        // simply pass metric straight through\r\n        if (metric === metricsConstants.DVB_ERRORS) {\r\n            if (reportingController) {\r\n                reportingController.report(metric, vo);\r\n            }\r\n        }\r\n    }\r\n\r\n    instance = {\r\n        initialize:         initialize,\r\n        reset:              reset,\r\n        handleNewMetric:    handleNewMetric\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nexport default dashjs.FactoryMaker.getClassFactory(DVBErrorsHandler); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n /**\r\n  * @ignore\r\n  */\r\nfunction GenericMetricHandler() {\r\n\r\n    let instance,\r\n        metricName,\r\n        reportingController;\r\n\r\n    function initialize(name, rc) {\r\n        metricName = name;\r\n        reportingController = rc;\r\n    }\r\n\r\n    function reset() {\r\n        reportingController = null;\r\n        metricName = undefined;\r\n    }\r\n\r\n    function handleNewMetric(metric, vo) {\r\n        // simply pass metric straight through\r\n        if (metric === metricName) {\r\n            if (reportingController) {\r\n                reportingController.report(metricName, vo);\r\n            }\r\n        }\r\n    }\r\n\r\n    instance = {\r\n        initialize:         initialize,\r\n        reset:              reset,\r\n        handleNewMetric:    handleNewMetric\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nGenericMetricHandler.__dashjs_factory_name = 'GenericMetricHandler';\r\nexport default dashjs.FactoryMaker.getClassFactory(GenericMetricHandler); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport HandlerHelpers from '../../utils/HandlerHelpers';\r\n\r\nfunction HttpListHandler(config) {\r\n\r\n    config = config || {};\r\n    let instance,\r\n        reportingController,\r\n        n,\r\n        type,\r\n        name,\r\n        interval;\r\n\r\n    let storedVos = [];\r\n\r\n    let handlerHelpers = HandlerHelpers(this.context).getInstance();\r\n\r\n    const metricsConstants = config.metricsConstants;\r\n\r\n    function intervalCallback() {\r\n        var vos = storedVos;\r\n\r\n        if (vos.length) {\r\n            if (reportingController) {\r\n                reportingController.report(name, vos);\r\n            }\r\n        }\r\n\r\n        storedVos = [];\r\n    }\r\n\r\n    function initialize(basename, rc, n_ms, requestType) {\r\n        if (rc) {\r\n\r\n            // this will throw if n is invalid, to be\r\n            // caught by the initialize caller.\r\n            n = handlerHelpers.validateN(n_ms);\r\n\r\n            reportingController = rc;\r\n\r\n            if (requestType && requestType.length) {\r\n                type = requestType;\r\n            }\r\n\r\n            name = handlerHelpers.reconstructFullMetricName(\r\n                basename,\r\n                n_ms,\r\n                requestType\r\n            );\r\n\r\n            interval = setInterval(intervalCallback, n);\r\n        }\r\n    }\r\n\r\n    function reset() {\r\n        clearInterval(interval);\r\n        interval = null;\r\n        n = null;\r\n        type = null;\r\n        storedVos = [];\r\n        reportingController = null;\r\n    }\r\n\r\n    function handleNewMetric(metric, vo) {\r\n        if (metric === metricsConstants.HTTP_REQUEST) {\r\n            if (!type || (type === vo.type)) {\r\n                storedVos.push(vo);\r\n            }\r\n        }\r\n    }\r\n\r\n    instance = {\r\n        initialize:         initialize,\r\n        reset:              reset,\r\n        handleNewMetric:    handleNewMetric\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nHttpListHandler.__dashjs_factory_name = 'HttpListHandler';\r\nexport default dashjs.FactoryMaker.getClassFactory(HttpListHandler); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport DVBReporting from './reporters/DVBReporting';\r\n\r\nfunction ReportingFactory(config) {\r\n    config = config || {};\r\n\r\n    const knownReportingSchemeIdUris = {\r\n        'urn:dvb:dash:reporting:2014': DVBReporting\r\n    };\r\n\r\n    const context = this.context;\r\n    let instance;\r\n    const logger = config.debug ? config.debug.getLogger(instance) : {};\r\n    const metricsConstants = config.metricsConstants;\r\n\r\n    function create(entry, rangeController) {\r\n        let reporting;\r\n\r\n        try {\r\n            reporting = knownReportingSchemeIdUris[entry.schemeIdUri](context).create({\r\n                metricsConstants: metricsConstants\r\n            });\r\n\r\n            reporting.initialize(entry, rangeController);\r\n        } catch (e) {\r\n            reporting = null;\r\n            logger.error(`ReportingFactory: could not create Reporting with schemeIdUri ${entry.schemeIdUri} (${e.message})`);\r\n        }\r\n\r\n        return reporting;\r\n    }\r\n\r\n    function register(schemeIdUri, moduleName) {\r\n        knownReportingSchemeIdUris[schemeIdUri] = moduleName;\r\n    }\r\n\r\n    function unregister(schemeIdUri) {\r\n        delete knownReportingSchemeIdUris[schemeIdUri];\r\n    }\r\n\r\n    instance = {\r\n        create:     create,\r\n        register:   register,\r\n        unregister: unregister\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nReportingFactory.__dashjs_factory_name = 'ReportingFactory';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(ReportingFactory); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport MetricSerialiser from '../../utils/MetricSerialiser';\r\nimport RNG from '../../utils/RNG';\r\n\r\nfunction DVBReporting(config) {\r\n    config = config || {};\r\n    let instance;\r\n\r\n    let context = this.context;\r\n    let metricSerialiser,\r\n        randomNumberGenerator,\r\n        reportingPlayerStatusDecided,\r\n        isReportingPlayer,\r\n        reportingUrl,\r\n        rangeController;\r\n\r\n    let USE_DRAFT_DVB_SPEC = true;\r\n    let allowPendingRequestsToCompleteOnReset = true;\r\n    let pendingRequests = [];\r\n\r\n    const metricsConstants = config.metricsConstants;\r\n\r\n    function setup() {\r\n        metricSerialiser = MetricSerialiser(context).getInstance();\r\n        randomNumberGenerator = RNG(context).getInstance();\r\n\r\n        resetInitialSettings();\r\n    }\r\n\r\n    function doGetRequest(url, successCB, failureCB) {\r\n        let req = new XMLHttpRequest();\r\n        const oncomplete = function () {\r\n            let reqIndex = pendingRequests.indexOf(req);\r\n\r\n            if (reqIndex === -1) {\r\n                return;\r\n            } else {\r\n                pendingRequests.splice(reqIndex, 1);\r\n            }\r\n\r\n            if ((req.status >= 200) && (req.status < 300)) {\r\n                if (successCB) {\r\n                    successCB();\r\n                }\r\n            } else {\r\n                if (failureCB) {\r\n                    failureCB();\r\n                }\r\n            }\r\n        };\r\n\r\n        pendingRequests.push(req);\r\n\r\n        try {\r\n            req.open('GET', url);\r\n            req.onloadend = oncomplete;\r\n            req.onerror = oncomplete;\r\n            req.send();\r\n        } catch (e) {\r\n            req.onerror();\r\n        }\r\n    }\r\n\r\n    function report(type, vos) {\r\n        if (!Array.isArray(vos)) {\r\n            vos = [vos];\r\n        }\r\n\r\n        // If the Player is not a reporting Player, then the Player shall\r\n        // not report any errors.\r\n        // ... In addition to any time restrictions specified by a Range\r\n        // element within the Metrics element.\r\n        if (isReportingPlayer && rangeController.isEnabled()) {\r\n\r\n            // This reporting mechanism operates by creating one HTTP GET\r\n            // request for every entry in the top level list of the metric.\r\n            vos.forEach(function (vo) {\r\n                let url = metricSerialiser.serialise(vo);\r\n\r\n                // this has been proposed for errata\r\n                if (USE_DRAFT_DVB_SPEC && (type !== metricsConstants.DVB_ERRORS)) {\r\n                    url = `metricname=${type}&${url}`;\r\n                }\r\n\r\n                // Take the value of the @reportingUrl attribute, append a\r\n                // question mark ('?') character and then append the string\r\n                // created in the previous step.\r\n                url = `${reportingUrl}?${url}`;\r\n\r\n                // Make an HTTP GET request to the URL contained within the\r\n                // string created in the previous step.\r\n                doGetRequest(url, null, function () {\r\n                    // If the Player is unable to make the report, for\r\n                    // example because the @reportingUrl is invalid, the\r\n                    // host cannot be reached, or an HTTP status code other\r\n                    // than one in the 200 series is received, the Player\r\n                    // shall cease being a reporting Player for the\r\n                    // duration of the MPD.\r\n                    isReportingPlayer = false;\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    function initialize(entry, rc) {\r\n        let probability;\r\n\r\n        rangeController = rc;\r\n\r\n        reportingUrl = entry['dvb:reportingUrl'];\r\n\r\n        // If a required attribute is missing, the Reporting descriptor may\r\n        // be ignored by the Player\r\n        if (!reportingUrl) {\r\n            throw new Error(\r\n                'required parameter missing (dvb:reportingUrl)'\r\n            );\r\n        }\r\n\r\n        // A Player's status, as a reporting Player or not, shall remain\r\n        // static for the duration of the MPD, regardless of MPD updates.\r\n        // (i.e. only calling reset (or failure) changes this state)\r\n        if (!reportingPlayerStatusDecided) {\r\n            // NOTE: DVB spec has a typo where it incorrectly references the\r\n            // priority attribute, which should be probability\r\n            probability = entry['dvb:probability'] || entry['dvb:priority'] || 0;\r\n            // If the @priority attribute is set to 1000, it shall be a reporting Player.\r\n            // If the @priority attribute is missing, the Player shall not be a reporting Player.\r\n            // For any other value of the @probability attribute, it shall decide at random whether to be a\r\n            // reporting Player, such that the probability of being one is @probability/1000.\r\n            if (probability && (probability === 1000 || ((probability / 1000) >= randomNumberGenerator.random()))) {\r\n                isReportingPlayer = true;\r\n            }\r\n\r\n            reportingPlayerStatusDecided = true;\r\n        }\r\n    }\r\n\r\n    function resetInitialSettings() {\r\n        reportingPlayerStatusDecided = false;\r\n        isReportingPlayer = false;\r\n        reportingUrl = null;\r\n        rangeController = null;\r\n    }\r\n\r\n    function reset() {\r\n        if (!allowPendingRequestsToCompleteOnReset) {\r\n            pendingRequests.forEach(req => req.abort());\r\n            pendingRequests = [];\r\n        }\r\n\r\n        resetInitialSettings();\r\n    }\r\n\r\n    instance = {\r\n        report:     report,\r\n        initialize: initialize,\r\n        reset:      reset\r\n    };\r\n\r\n    setup();\r\n\r\n    return instance;\r\n}\r\n\r\nDVBReporting.__dashjs_factory_name = 'DVBReporting';\r\nexport default dashjs.FactoryMaker.getClassFactory(DVBReporting); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport DVBErrors from '../vo/DVBErrors';\r\nimport MetricsReportingEvents from '../MetricsReportingEvents';\r\n\r\nfunction DVBErrorsTranslator(config) {\r\n\r\n    config = config || {};\r\n    let instance,\r\n        mpd;\r\n    const eventBus = config.eventBus;\r\n    const dashMetrics = config.dashMetrics;\r\n    const metricsConstants = config.metricsConstants;\r\n    //MediaPlayerEvents have been added to Events in MediaPlayer class\r\n    const Events = config.events;\r\n\r\n    function report(vo) {\r\n        let o = new DVBErrors();\r\n\r\n        if (!mpd) {\r\n            return;\r\n        }\r\n\r\n        for (const key in vo) {\r\n            if (vo.hasOwnProperty(key)) {\r\n                o[key] = vo[key];\r\n            }\r\n        }\r\n\r\n        if (!o.mpdurl) {\r\n            o.mpdurl = mpd.originalUrl || mpd.url;\r\n        }\r\n\r\n        if (!o.terror) {\r\n            o.terror = new Date();\r\n        }\r\n\r\n        dashMetrics.addDVBErrors(o);\r\n    }\r\n\r\n    function onManifestUpdate(e) {\r\n        if (e.error) {\r\n            return;\r\n        }\r\n\r\n        mpd = e.manifest;\r\n    }\r\n\r\n    function onServiceLocationChanged(e) {\r\n        report({\r\n            errorcode:          DVBErrors.BASE_URL_CHANGED,\r\n            servicelocation:    e.entry\r\n        });\r\n    }\r\n\r\n    function onBecameReporter() {\r\n        report({\r\n            errorcode: DVBErrors.BECAME_REPORTER\r\n        });\r\n    }\r\n\r\n    function handleHttpMetric(vo) {\r\n        if ((vo.responsecode === 0) ||      // connection failure - unknown\r\n                (vo.responsecode >= 400) || // HTTP error status code\r\n                (vo.responsecode < 100) ||  // unknown status codes\r\n                (vo.responsecode >= 600)) { // unknown status codes\r\n            report({\r\n                errorcode:          vo.responsecode || DVBErrors.CONNECTION_ERROR,\r\n                url:                vo.url,\r\n                terror:             vo.tresponse,\r\n                servicelocation:    vo._serviceLocation\r\n            });\r\n        }\r\n    }\r\n\r\n    function onMetricEvent(e) {\r\n        switch (e.metric) {\r\n        case metricsConstants.HTTP_REQUEST:\r\n            handleHttpMetric(e.value);\r\n            break;\r\n        default:\r\n            break;\r\n        }\r\n    }\r\n\r\n    function onPlaybackError(e) {\r\n        let reason = e.error ? e.error.code : 0;\r\n        let errorcode;\r\n\r\n        switch (reason) {\r\n            case MediaError.MEDIA_ERR_NETWORK:\r\n                errorcode = DVBErrors.CONNECTION_ERROR;\r\n                break;\r\n            case MediaError.MEDIA_ERR_DECODE:\r\n                errorcode = DVBErrors.CORRUPT_MEDIA_OTHER;\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n\r\n        report({\r\n            errorcode: errorcode\r\n        });\r\n    }\r\n\r\n    function initialise() {\r\n        eventBus.on(Events.MANIFEST_UPDATED, onManifestUpdate, instance);\r\n        eventBus.on(\r\n            Events.SERVICE_LOCATION_BLACKLIST_CHANGED,\r\n            onServiceLocationChanged,\r\n            instance\r\n        );\r\n        eventBus.on(Events.METRIC_ADDED, onMetricEvent, instance);\r\n        eventBus.on(Events.METRIC_UPDATED, onMetricEvent, instance);\r\n        eventBus.on(Events.PLAYBACK_ERROR, onPlaybackError, instance);\r\n        eventBus.on(\r\n            MetricsReportingEvents.BECAME_REPORTING_PLAYER,\r\n            onBecameReporter,\r\n            instance\r\n        );\r\n    }\r\n\r\n    function reset() {\r\n        eventBus.off(Events.MANIFEST_UPDATED, onManifestUpdate, instance);\r\n        eventBus.off(\r\n            Events.SERVICE_LOCATION_BLACKLIST_CHANGED,\r\n            onServiceLocationChanged,\r\n            instance\r\n        );\r\n        eventBus.off(Events.METRIC_ADDED, onMetricEvent, instance);\r\n        eventBus.off(Events.METRIC_UPDATED, onMetricEvent, instance);\r\n        eventBus.off(Events.PLAYBACK_ERROR, onPlaybackError, instance);\r\n        eventBus.off(\r\n            MetricsReportingEvents.BECAME_REPORTING_PLAYER,\r\n            onBecameReporter,\r\n            instance\r\n        );\r\n    }\r\n\r\n    instance = {\r\n        initialise: initialise,\r\n        reset:      reset\r\n    };\r\n\r\n    initialise();\r\n\r\n    return instance;\r\n}\r\n\r\nDVBErrorsTranslator.__dashjs_factory_name = 'DVBErrorsTranslator';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(DVBErrorsTranslator); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n /**\r\n  * @ignore\r\n  */\r\nfunction HandlerHelpers() {\r\n    return {\r\n        reconstructFullMetricName: function (key, n, type) {\r\n            let mn = key;\r\n\r\n            if (n) {\r\n                mn += '(' + n;\r\n\r\n                if (type && type.length) {\r\n                    mn += ',' + type;\r\n                }\r\n\r\n                mn += ')';\r\n            }\r\n\r\n            return mn;\r\n        },\r\n\r\n        validateN: function (n_ms) {\r\n            if (!n_ms) {\r\n                throw new Error('missing n');\r\n            }\r\n\r\n            if (isNaN(n_ms)) {\r\n                throw new Error('n is NaN');\r\n            }\r\n\r\n            // n is a positive integer is defined to refer to the metric\r\n            // in which the buffer level is recorded every n ms.\r\n            if (n_ms < 0) {\r\n                throw new Error('n must be positive');\r\n            }\r\n\r\n            return n_ms;\r\n        }\r\n    };\r\n}\r\n\r\nHandlerHelpers.__dashjs_factory_name = 'HandlerHelpers';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(HandlerHelpers); /* jshint ignore:line */\r\n","import Metrics from '../vo/Metrics';\r\nimport Range from '../vo/Range';\r\nimport Reporting from '../vo/Reporting';\r\n\r\nfunction ManifestParsing (config) {\r\n    config = config || {};\r\n    let instance;\r\n    let adapter = config.adapter;\r\n    const constants = config.constants;\r\n\r\n    function getMetricsRangeStartTime(manifest, dynamic, range) {\r\n        let voPeriods,\r\n            reportingStartTime;\r\n        let presentationStartTime = 0;\r\n\r\n        if (dynamic) {\r\n            // For services with MPD@type='dynamic', the start time is\r\n            // indicated in wall clock time by adding the value of this\r\n            // attribute to the value of the MPD@availabilityStartTime\r\n            // attribute.\r\n            presentationStartTime = adapter.getAvailabilityStartTime(manifest) / 1000;\r\n        } else {\r\n            // For services with MPD@type='static', the start time is indicated\r\n            // in Media Presentation time and is relative to the PeriodStart\r\n            // time of the first Period in this MPD.\r\n            voPeriods = adapter.getRegularPeriods(manifest);\r\n\r\n            if (voPeriods.length) {\r\n                presentationStartTime = voPeriods[0].start;\r\n            }\r\n        }\r\n\r\n        // When not present, DASH Metrics collection is\r\n        // requested from the beginning of content\r\n        // consumption.\r\n        reportingStartTime = presentationStartTime;\r\n\r\n        if (range && range.hasOwnProperty(constants.START_TIME)) {\r\n            reportingStartTime += range.starttime;\r\n        }\r\n\r\n        return reportingStartTime;\r\n    }\r\n\r\n    function getMetrics(manifest) {\r\n        let metrics = [];\r\n\r\n        if (manifest && manifest.Metrics_asArray) {\r\n            manifest.Metrics_asArray.forEach(metric => {\r\n                var metricEntry = new Metrics();\r\n                var isDynamic = adapter.getIsDynamic(manifest);\r\n\r\n                if (metric.hasOwnProperty('metrics')) {\r\n                    metricEntry.metrics = metric.metrics;\r\n                } else {\r\n                    return;\r\n                }\r\n\r\n                if (metric.Range_asArray) {\r\n                    metric.Range_asArray.forEach(range => {\r\n                        var rangeEntry = new Range();\r\n\r\n                        rangeEntry.starttime =\r\n                            getMetricsRangeStartTime(manifest, isDynamic, range);\r\n\r\n                        if (range.hasOwnProperty('duration')) {\r\n                            rangeEntry.duration = range.duration;\r\n                        } else {\r\n                            // if not present, the value is identical to the\r\n                            // Media Presentation duration.\r\n                            rangeEntry.duration = adapter.getDuration(manifest);\r\n                        }\r\n\r\n                        rangeEntry._useWallClockTime = isDynamic;\r\n\r\n                        metricEntry.Range.push(rangeEntry);\r\n                    });\r\n                }\r\n\r\n                if (metric.Reporting_asArray) {\r\n                    metric.Reporting_asArray.forEach(reporting => {\r\n                        var reportingEntry = new Reporting();\r\n\r\n                        if (reporting.hasOwnProperty(constants.SCHEME_ID_URI)) {\r\n                            reportingEntry.schemeIdUri = reporting.schemeIdUri;\r\n                        } else {\r\n                            // Invalid Reporting. schemeIdUri must be set. Ignore.\r\n                            return;\r\n                        }\r\n\r\n                        for (const prop in reporting) {\r\n                            if (reporting.hasOwnProperty(prop)) {\r\n                                reportingEntry[prop] = reporting[prop];\r\n                            }\r\n                        }\r\n\r\n                        metricEntry.Reporting.push(reportingEntry);\r\n                    });\r\n                } else {\r\n                    // Invalid Metrics. At least one reporting must be present. Ignore\r\n                    return;\r\n                }\r\n\r\n                metrics.push(metricEntry);\r\n            });\r\n        }\r\n\r\n        return metrics;\r\n    }\r\n\r\n    instance = {\r\n        getMetrics: getMetrics\r\n    };\r\n\r\n    return instance;\r\n}\r\n\r\nManifestParsing.__dashjs_factory_name = 'ManifestParsing';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(ManifestParsing); /* jshint ignore:line */","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n/**\r\n * @ignore\r\n */\r\nfunction MetricSerialiser() {\r\n\r\n    // For each entry in the top level list within the metric (in the case\r\n    // of the DVBErrors metric each entry corresponds to an \"error event\"\r\n    // described in clause 10.8.4) the Player shall:\r\n    function serialise(metric) {\r\n        let pairs = [];\r\n        let obj = [];\r\n        let key,\r\n            value;\r\n\r\n        // Take each (key, value) pair from the metric entry and create a\r\n        // string consisting of the name of the key, followed by an equals\r\n        // ('=') character, followed by the string representation of the\r\n        // value. The string representation of the value is created based\r\n        // on the type of the value following the instructions in Table 22.\r\n        for (key in metric) {\r\n            if (metric.hasOwnProperty(key) && (key.indexOf('_') !== 0)) {\r\n                value = metric[key];\r\n\r\n                // we want to ensure that keys still end up in the report\r\n                // even if there is no value\r\n                if ((value === undefined) || (value === null)) {\r\n                    value = '';\r\n                }\r\n\r\n                // DVB A168 10.12.4 Table 22\r\n                if (Array.isArray(value)) {\r\n                    // if trace or similar is null, do not include in output\r\n                    if (!value.length) {\r\n                        continue;\r\n                    }\r\n\r\n                    obj = [];\r\n\r\n                    value.forEach(function (v) {\r\n                        let isBuiltIn = Object.prototype.toString.call(v).slice(8, -1) !== 'Object';\r\n\r\n                        obj.push(isBuiltIn ? v : serialise(v));\r\n                    });\r\n\r\n                    value = obj.map(encodeURIComponent).join(',');\r\n                } else if (typeof value === 'string') {\r\n                    value = encodeURIComponent(value);\r\n                } else if (value instanceof Date) {\r\n                    value = value.toISOString();\r\n                } else if (typeof value === 'number') {\r\n                    value = Math.round(value);\r\n                }\r\n\r\n                pairs.push(key + '=' + value);\r\n            }\r\n        }\r\n\r\n        // Concatenate the strings created in the previous step with an\r\n        // ampersand ('&') character between each one.\r\n        return pairs.join('&');\r\n    }\r\n\r\n    return {\r\n        serialise: serialise\r\n    };\r\n}\r\n\r\nMetricSerialiser.__dashjs_factory_name = 'MetricSerialiser';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(MetricSerialiser); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\n /**\r\n  * @ignore\r\n  */\r\nfunction RNG() {\r\n\r\n    // check whether secure random numbers are available. if not, revert to\r\n    // using Math.random\r\n    let crypto = window.crypto || window.msCrypto;\r\n\r\n    // could just as easily use any other array type by changing line below\r\n    let ArrayType = Uint32Array;\r\n    let MAX_VALUE = Math.pow(2, ArrayType.BYTES_PER_ELEMENT * 8) - 1;\r\n\r\n    // currently there is only one client for this code, and that only uses\r\n    // a single random number per initialisation. may want to increase this\r\n    // number if more consumers in the future\r\n    let NUM_RANDOM_NUMBERS = 10;\r\n\r\n    let randomNumbers,\r\n        index,\r\n        instance;\r\n\r\n    function initialise() {\r\n        if (crypto) {\r\n            if (!randomNumbers) {\r\n                randomNumbers = new ArrayType(NUM_RANDOM_NUMBERS);\r\n            }\r\n            crypto.getRandomValues(randomNumbers);\r\n            index = 0;\r\n        }\r\n    }\r\n\r\n    function rand(min, max) {\r\n        let r;\r\n\r\n        if (!min) {\r\n            min = 0;\r\n        }\r\n\r\n        if (!max) {\r\n            max = 1;\r\n        }\r\n\r\n        if (crypto) {\r\n            if (index === randomNumbers.length) {\r\n                initialise();\r\n            }\r\n\r\n            r = randomNumbers[index] / MAX_VALUE;\r\n            index += 1;\r\n        } else {\r\n            r = Math.random();\r\n        }\r\n\r\n        return (r * (max - min)) + min;\r\n    }\r\n\r\n    instance = {\r\n        random: rand\r\n    };\r\n\r\n    initialise();\r\n\r\n    return instance;\r\n}\r\n\r\nRNG.__dashjs_factory_name = 'RNG';\r\nexport default dashjs.FactoryMaker.getSingletonFactory(RNG); /* jshint ignore:line */\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @class\r\n * @ignore\r\n */\r\nclass DVBErrors {\r\n    constructor() {\r\n        this.mpdurl = null;\r\n        // String - Absolute URL from which the MPD was originally\r\n        // retrieved (MPD updates will not change this value).\r\n\r\n        this.errorcode = null;\r\n        // String - The value of errorcode depends upon the type\r\n        // of error being reported. For an error listed in the\r\n        // ErrorType column below the value is as described in the\r\n        // Value column.\r\n        //\r\n        // ErrorType                                            Value\r\n        // ---------                                            -----\r\n        // HTTP error status code                               HTTP status code\r\n        // Unknown HTTP status code                             HTTP status code\r\n        // SSL connection failed                                \"SSL\" followed by SSL alert value\r\n        // DNS resolution failed                                \"C00\"\r\n        // Host unreachable                                     \"C01\"\r\n        // Connection refused                                   \"C02\"\r\n        // Connection error  Not otherwise specified           \"C03\"\r\n        // Corrupt media  ISO BMFF container cannot be parsed  \"M00\"\r\n        // Corrupt media  Not otherwise specified              \"M01\"\r\n        // Changing Base URL in use due to errors               \"F00\"\r\n        // Becoming an error reporting Player                   \"S00\"\r\n\r\n        this.terror = null;\r\n        // Real-Time - Date and time at which error occurred in UTC,\r\n        // formatted as a combined date and time according to ISO 8601.\r\n\r\n        this.url = null;\r\n        // String - Absolute URL from which data was being requested\r\n        // when this error occurred. If the error report is in relation\r\n        // to corrupt media or changing BaseURL, this may be a null\r\n        // string if the URL from which the media was obtained or\r\n        // which led to the change of BaseURL is no longer known.\r\n\r\n        this.ipaddress = null;\r\n        // String - IP Address which the host name in \"url\" resolved to.\r\n        // If the error report is in relation to corrupt media or\r\n        // changing BaseURL, this may be a null string if the URL\r\n        // from which the media was obtained or which led to the\r\n        // change of BaseURL is no longer known.\r\n\r\n        this.servicelocation = null;\r\n        // String - The value of the serviceLocation field in the\r\n        // BaseURL being used. In the event of this report indicating\r\n        // a change of BaseURL this is the value from the BaseURL\r\n        // being moved from.\r\n    }\r\n}\r\n\r\nDVBErrors.SSL_CONNECTION_FAILED_PREFIX = 'SSL';\r\nDVBErrors.DNS_RESOLUTION_FAILED =        'C00';\r\nDVBErrors.HOST_UNREACHABLE =             'C01';\r\nDVBErrors.CONNECTION_REFUSED =           'C02';\r\nDVBErrors.CONNECTION_ERROR =             'C03';\r\nDVBErrors.CORRUPT_MEDIA_ISOBMFF =        'M00';\r\nDVBErrors.CORRUPT_MEDIA_OTHER =          'M01';\r\nDVBErrors.BASE_URL_CHANGED =             'F00';\r\nDVBErrors.BECAME_REPORTER =              'S00';\r\n\r\nexport default DVBErrors;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @class\r\n * @ignore\r\n */\r\nclass Metrics {\r\n    constructor() {\r\n\r\n        this.metrics = '';\r\n        this.Range = [];\r\n        this.Reporting = [];\r\n    }\r\n}\r\n\r\nexport default Metrics;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @class\r\n * @ignore\r\n */\r\nclass Range {\r\n    constructor() {\r\n\r\n        // as defined in ISO23009-1\r\n        this.starttime = 0;\r\n        this.duration = Infinity;\r\n\r\n        // for internal use\r\n        this._useWallClockTime = false;\r\n    }\r\n}\r\n\r\nexport default Range;\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n/**\r\n * @class\r\n * @ignore\r\n */\r\nclass Reporting {\r\n    constructor() {\r\n        // Reporting is a DescriptorType and doesn't have any additional fields\r\n        this.schemeIdUri = '';\r\n        this.value = '';\r\n    }\r\n}\r\n\r\nexport default Reporting;\r\n","/**\r\n* The copyright in this software is being made available under the BSD License,\r\n* included below. This software may be subject to other third party and contributor\r\n* rights, including patent rights, and no such rights are granted under this license.\r\n*\r\n* Copyright (c) 2013, Dash Industry Forum.\r\n* All rights reserved.\r\n*\r\n* Redistribution and use in source and binary forms, with or without modification,\r\n* are permitted provided that the following conditions are met:\r\n*  * Redistributions of source code must retain the above copyright notice, this\r\n*  list of conditions and the following disclaimer.\r\n*  * Redistributions in binary form must reproduce the above copyright notice,\r\n*  this list of conditions and the following disclaimer in the documentation and/or\r\n*  other materials provided with the distribution.\r\n*  * Neither the name of Dash Industry Forum nor the names of its\r\n*  contributors may be used to endorse or promote products derived from this software\r\n*  without specific prior written permission.\r\n*\r\n*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n*  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n*  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n*  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n*  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n*  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n*  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n*  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n*  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n*  POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\nimport FactoryMaker from '../../core/FactoryMaker';\r\nimport { checkInteger } from '../utils/SupervisorTools';\r\n\r\nfunction CustomTimeRanges(/*config*/) {\r\n    let customTimeRangeArray = [];\r\n    let length = 0;\r\n\r\n    function add(start, end) {\r\n        let i = 0;\r\n\r\n        for (i = 0; (i < this.customTimeRangeArray.length) && (start > this.customTimeRangeArray[i].start); i++);\r\n\r\n        this.customTimeRangeArray.splice(i, 0, {start: start,end: end});\r\n\r\n        for (i = 0; i < this.customTimeRangeArray.length - 1; i++) {\r\n            if (this.mergeRanges(i,i + 1)) {\r\n                i--;\r\n            }\r\n        }\r\n        this.length = this.customTimeRangeArray.length;\r\n    }\r\n\r\n    function clear() {\r\n        this.customTimeRangeArray = [];\r\n        this.length = 0;\r\n    }\r\n\r\n    function remove(start, end) {\r\n        for (let i = 0; i < this.customTimeRangeArray.length; i++) {\r\n            if (start <= this.customTimeRangeArray[i].start && end >= this.customTimeRangeArray[i].end) {\r\n                //      |--------------Range i-------|\r\n                //|---------------Range to remove ---------------|\r\n                //    or\r\n                //|--------------Range i-------|\r\n                //|--------------Range to remove ---------------|\r\n                //    or\r\n                //                 |--------------Range i-------|\r\n                //|--------------Range to remove ---------------|\r\n                this.customTimeRangeArray.splice(i,1);\r\n                i--;\r\n\r\n            } else if (start > this.customTimeRangeArray[i].start && end < this.customTimeRangeArray[i].end) {\r\n                //|-----------------Range i----------------|\r\n                //        |-------Range to remove -----|\r\n                this.customTimeRangeArray.splice(i + 1, 0, {start: end,end: this.customTimeRangeArray[i].end});\r\n                this.customTimeRangeArray[i].end = start;\r\n                break;\r\n            } else if ( start > this.customTimeRangeArray[i].start && start < this.customTimeRangeArray[i].end) {\r\n                //|-----------Range i----------|\r\n                //                    |---------Range to remove --------|\r\n                //    or\r\n                //|-----------------Range i----------------|\r\n                //            |-------Range to remove -----|\r\n                this.customTimeRangeArray[i].end = start;\r\n            } else if ( end > this.customTimeRangeArray[i].start && end < this.customTimeRangeArray[i].end) {\r\n                //                     |-----------Range i----------|\r\n                //|---------Range to remove --------|\r\n                //            or\r\n                //|-----------------Range i----------------|\r\n                //|-------Range to remove -----|\r\n                this.customTimeRangeArray[i].start = end;\r\n            }\r\n        }\r\n\r\n        this.length = this.customTimeRangeArray.length;\r\n    }\r\n\r\n    function mergeRanges(rangeIndex1, rangeIndex2) {\r\n        let range1 = this.customTimeRangeArray[rangeIndex1];\r\n        let range2 = this.customTimeRangeArray[rangeIndex2];\r\n\r\n        if (range1.start <=  range2.start && range2.start <= range1.end && range1.end <= range2.end) {\r\n            //|-----------Range1----------|\r\n            //                    |-----------Range2----------|\r\n            range1.end = range2.end;\r\n            this.customTimeRangeArray.splice(rangeIndex2,1);\r\n            return true;\r\n\r\n        } else if (range2.start <= range1.start && range1.start <= range2.end && range2.end <= range1.end) {\r\n            //                |-----------Range1----------|\r\n            //|-----------Range2----------|\r\n            range1.start = range2.start;\r\n            this.customTimeRangeArray.splice(rangeIndex2,1);\r\n            return true;\r\n        } else if (range2.start <= range1.start && range1.start <= range2.end && range1.end <= range2.end) {\r\n            //      |--------Range1-------|\r\n            //|---------------Range2--------------|\r\n            this.customTimeRangeArray.splice(rangeIndex1,1);\r\n            return true;\r\n        } else if (range1.start <= range2.start && range2.start <= range1.end && range2.end <= range1.end) {\r\n            //|-----------------Range1--------------|\r\n            //        |-----------Range2----------|\r\n            this.customTimeRangeArray.splice(rangeIndex2,1);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    function start(index) {\r\n        checkInteger(index);\r\n\r\n        if (index >= this.customTimeRangeArray.length || index < 0) {\r\n            return NaN;\r\n        }\r\n\r\n        return this.customTimeRangeArray[index].start;\r\n    }\r\n\r\n    function end(index) {\r\n        checkInteger(index);\r\n\r\n        if (index >= this.customTimeRangeArray.length || index < 0) {\r\n            return NaN;\r\n        }\r\n\r\n        return this.customTimeRangeArray[index].end;\r\n    }\r\n\r\n    return {\r\n        customTimeRangeArray: customTimeRangeArray,\r\n        length: length,\r\n        add: add,\r\n        clear: clear,\r\n        remove: remove,\r\n        mergeRanges: mergeRanges,\r\n        start: start,\r\n        end: end\r\n    };\r\n}\r\nCustomTimeRanges.__dashjs_factory_name = 'CustomTimeRanges';\r\nexport default FactoryMaker.getClassFactory(CustomTimeRanges);\r\n","/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\nimport Constants from '../constants/Constants';\r\n\r\nexport function checkParameterType(parameter, type) {\r\n    if (typeof parameter !== type) {\r\n        throw Constants.BAD_ARGUMENT_ERROR;\r\n    }\r\n}\r\n\r\nexport function checkInteger(parameter) {\r\n    const isInt = parameter !== null && !isNaN(parameter) && (parameter % 1 === 0);\r\n\r\n    if (!isInt) {\r\n        throw Constants.BAD_ARGUMENT_ERROR + ' : argument is not an integer';\r\n    }\r\n}\r\n\r\nexport function checkRange(parameter, min, max) {\r\n    if (parameter < min || parameter > max) {\r\n        throw Constants.BAD_ARGUMENT_ERROR + ' : argument out of range';\r\n    }\r\n}\r\n\r\nexport function checkIsVideoOrAudioType(type) {\r\n    if (typeof type !== 'string' || (type !== Constants.AUDIO && type !== Constants.VIDEO)) {\r\n        throw Constants.BAD_ARGUMENT_ERROR;\r\n    }\r\n}"],"names":["f","g","exports","module","define","amd","window","global","self","this","dashjs","MetricsReporting","r","e","n","t","o","i","c","require","u","a","Error","code","p","call","length","1","_dereq_","instance","singletonContexts","singletonFactories","classFactories","FactoryMaker","undefined","extend","name","childInstance","override","context","getSingletonInstance","setSingletonInstance","className","obj","push","getSingletonFactory","classConstructor","factory","getFactoryByName","__dashjs_factory_name","getInstance","merge","arguments","getSingletonFactoryByName","updateSingletonFactory","updateFactory","getClassFactory","create","getClassFactoryByName","updateClassFactory","factoriesArray","args","classInstance","extensionObject","prop","extension","apply","parent","hasOwnProperty","getClassName","EventsBase","events","config","evt","publicOnly","indexOf","Constants","init","constants","STREAM","VIDEO","AUDIO","TEXT","FRAGMENTED_TEXT","EMBEDDED_TEXT","MUXED","IMAGE","STPP","TTML","VTT","WVTT","ABR_STRATEGY_DYNAMIC","ABR_STRATEGY_BOLA","ABR_STRATEGY_THROUGHPUT","MOVING_AVERAGE_SLIDING_WINDOW","MOVING_AVERAGE_EWMA","BAD_ARGUMENT_ERROR","MISSING_CONFIG_ERROR","TRACK_SWITCH_MODE_ALWAYS_REPLACE","TRACK_SWITCH_MODE_NEVER_REPLACE","TRACK_SELECTION_MODE_HIGHEST_BITRATE","TRACK_SELECTION_MODE_WIDEST_RANGE","LOCATION","INITIALIZE","TEXT_SHOWING","TEXT_HIDDEN","CC1","CC3","UTF8","SCHEME_ID_URI","START_TIME","SERVICE_DESCRIPTION_LL_SCHEME","SUPPLEMENTAL_PROPERTY_LL_SCHEME","XML","ARRAY_BUFFER","createMetricsReporting","_utilsDVBErrorsTranslator2","eventBus","dashMetrics","metricsConstants","_controllersMetricsCollectionController2","getReportingFactory","_reportingReportingFactory2","getMetricsHandlerFactory","_metricsMetricsHandlerFactory2","_MetricsReportingEvents2","MetricsReportingEvents","_get","Object","getPrototypeOf","prototype","METRICS_INITIALISATION_COMPLETE","BECAME_REPORTING_PLAYER","CMCD_DATA_GENERATED","metricsReportingEvents","MetricsCollectionController","metricsControllers","update","controllersToRemove","error","keys","_utilsManifestParsing2","adapter","getMetrics","manifest","forEach","m","key","JSON","stringify","splice","controller","_MetricsController2","initialize","reset","trigger","resetMetricsControllers","off","MANIFEST_UPDATED","STREAM_TEARDOWN_COMPLETE","on","MetricsController","metricsHandlersController","reportingController","rangeController","metricsEntry","_RangeController2","mediaElement","Range","_ReportingController2","debug","Reporting","_MetricsHandlersController2","metrics","MetricsHandlersController","handlers","Events","metricsHandlerFactory","handle","handler","handleNewMetric","metric","value","mediaType","split","midx","ms","nextm","METRIC_ADDED","METRIC_UPDATED","RangeController","useWallClockTime","ranges","rs","start","starttime","end","duration","add","_useWallClockTime","clear","isEnabled","time","numRanges","Date","getTime","currentTime","_utilsCustomTimeRanges2","ReportingController","reporters","reportingFactory","reporting","some","reporter","report","type","vos","MetricsHandlerFactory","logger","getLogger","keyRegex","knownFactoryProducts","BufferLevel","_handlersBufferLevelHandler2","DVBErrors","_handlersDVBErrorsHandler2","HttpList","_handlersHttpListHandler2","PlayList","_handlersGenericMetricHandler2","RepSwitchList","TcpList","listType","matches","match","message","register","unregister","BufferLevelHandler","interval","lastReportedTime","handlerHelpers","_utilsHandlerHelpers2","storedVOs","intervalCallback","vo","map","reduce","b","level","getLowestBufferLevelVO","basename","rc","n_ms","validateN","reconstructFullMetricName","setInterval","clearInterval","BUFFER_LEVEL","onInitialisationComplete","unused","DVB_ERRORS","GenericMetricHandler","metricName","HttpListHandler","storedVos","requestType","HTTP_REQUEST","ReportingFactory","knownReportingSchemeIdUris","urn:dvb:dash:reporting:2014","_reportersDVBReporting2","entry","schemeIdUri","moduleName","DVBReporting","metricSerialiser","randomNumberGenerator","reportingPlayerStatusDecided","isReportingPlayer","reportingUrl","pendingRequests","doGetRequest","url","successCB","failureCB","oncomplete","reqIndex","req","status","XMLHttpRequest","open","onloadend","onerror","send","resetInitialSettings","Array","isArray","serialise","probability","random","_utilsMetricSerialiser2","_utilsRNG2","DVBErrorsTranslator","mpd","_voDVBErrors2","mpdurl","originalUrl","terror","addDVBErrors","onManifestUpdate","onServiceLocationChanged","errorcode","BASE_URL_CHANGED","servicelocation","onBecameReporter","BECAME_REPORTER","onMetricEvent","responsecode","CONNECTION_ERROR","tresponse","_serviceLocation","onPlaybackError","MediaError","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","CORRUPT_MEDIA_OTHER","initialise","SERVICE_LOCATION_BLACKLIST_CHANGED","PLAYBACK_ERROR","HandlerHelpers","mn","isNaN","ManifestParsing","Metrics_asArray","metricEntry","_voMetrics2","isDynamic","getIsDynamic","Range_asArray","range","reportingStartTime","presentationStartTime","rangeEntry","_voRange2","getAvailabilityStartTime","voPeriods","getRegularPeriods","getDuration","Reporting_asArray","reportingEntry","_voReporting2","MetricSerialiser","pairs","v","isBuiltIn","toString","slice","encodeURIComponent","join","toISOString","Math","round","RNG","crypto","msCrypto","ArrayType","Uint32Array","MAX_VALUE","pow","BYTES_PER_ELEMENT","NUM_RANDOM_NUMBERS","randomNumbers","index","getRandomValues","min","max","ipaddress","SSL_CONNECTION_FAILED_PREFIX","DNS_RESOLUTION_FAILED","HOST_UNREACHABLE","CONNECTION_REFUSED","CORRUPT_MEDIA_ISOBMFF","Metrics","Infinity","CustomTimeRanges","customTimeRangeArray","mergeRanges","remove","rangeIndex1","rangeIndex2","range1","range2","_utilsSupervisorTools","checkInteger","NaN","_coreFactoryMaker2","parameter","_constantsConstants2"],"mappings":"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"}