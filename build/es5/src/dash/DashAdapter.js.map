{"version":3,"sources":["../../../../src/dash/DashAdapter.js"],"names":["DashAdapter","instance","dashManifestModel","voPeriods","voAdaptations","currentMediaInfo","setup","reset","setConfig","config","getRepresentationForRepresentationInfo","representationInfo","representationController","getRepresentationForQuality","quality","getAdaptationForMediaInfo","mediaInfo","streamInfo","id","undefined","index","getPeriodForStreamInfo","voPeriodsArray","ln","length","i","voPeriod","convertRepresentationToRepresentationInfo","voRepresentation","RepresentationInfo","realAdaptation","adaptation","period","mpd","manifest","Period_asArray","AdaptationSet_asArray","realRepresentation","getRepresentationFor","bandwidth","getBandwidth","DVRWindow","segmentAvailabilityRange","fragmentDuration","segmentDuration","segments","duration","NaN","MSETimeOffset","useCalculatedLiveEdgeTime","convertAdaptationToMediaInfo","MediaInfo","viewpoint","type","convertPeriodToStreamInfo","representationCount","getRepresentationCount","labels","getLabelsForAdaptation","lang","getLanguageForAdaptation","getViewpointForAdaptation","value","accessibility","getAccessibilityForAdaptation","map","accessibilityValue","accessibilityData","schemeIdUri","search","cea608parser","embeddedCaptions","audioChannelConfiguration","getAudioChannelConfigurationForAdaptation","roles","getRolesForAdaptation","role","codec","getCodec","mimeType","getMimeType","contentProtection","getContentProtectionData","bitrateList","getBitrateListForAdaptation","forEach","item","KID","getKID","isText","getIsTextTrack","convertVideoInfoToEmbeddedTextInfo","channel","parseInt","substring","Constants","EMBEDDED_TEXT","isEmbedded","convertVideoInfoToThumbnailInfo","IMAGE","StreamInfo","THRESHOLD","start","manifestInfo","convertMpdToManifestInfo","isLast","Math","abs","ManifestInfo","DVRWindowSize","timeShiftBufferDepth","loadedTime","availableFrom","availabilityStartTime","minBufferTime","maxFragmentDuration","maxSegmentDuration","getDuration","isDynamic","getIsDynamic","protocol","getMediaInfoForType","getAdaptationForType","selectedVoPeriod","periodId","idx","getIndexForAdaptation","getAdaptationsForPeriod","getIsMain","filter","DashConstants","MAIN","periodIndex","adaptations","getAdaptationsForType","allMediaInfoForType","getAllMediaInfoForType","isMediaInfoEqual","externalManifest","voLocalPeriods","mediaArr","data","media","j","checkSetConfigCall","getMpd","getRegularPeriods","adaptationsForType","VIDEO","accessibilityLength","indexOf","parts","split","call","push","CC1","hasOwnProperty","Error","updatePeriods","newManifest","getStreamsInfo","maxStreamsInfo","streams","checkStreamProcessor","streamProcessor","checkRepresentationController","getInitRequest","representation","indexHandler","getRepresentationController","getIndexHandler","getFragmentRequest","time","options","fragRequest","getSegmentRequestForTime","getNextSegmentRequest","getIndexHandlerTime","getCurrentTime","setIndexHandlerTime","setCurrentTime","resetIndexHandler","resetIndex","updateData","getStreamInfo","getMediaInfo","voAdaptation","getType","getAdaptationForId","getAdaptationForIndex","getRepresentationInfo","getCurrentRepresentation","getEvent","eventBox","eventStreams","startTime","event","Event","scheme_id_uri","timescale","presentationTimeDelta","presentation_time_delta","event_duration","messageData","message_data","presentationTime","eventStream","getEventsFor","info","events","getEventsForPeriod","getEventStreamForAdaptationSet","getEventStreamForRepresentation","setCurrentMediaInfo","streamId","convertDataToRepresentationInfo","getDataForMedia","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"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","file":"DashAdapter.js","sourcesContent":["/**\r\n * The copyright in this software is being made available under the BSD License,\r\n * included below. This software may be subject to other third party and contributor\r\n * rights, including patent rights, and no such rights are granted under this license.\r\n *\r\n * Copyright (c) 2013, Dash Industry Forum.\r\n * All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright notice, this\r\n *  list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation and/or\r\n *  other materials provided with the distribution.\r\n *  * Neither the name of Dash Industry Forum nor the names of its\r\n *  contributors may be used to endorse or promote products derived from this software\r\n *  without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\r\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\r\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\r\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\r\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\r\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\r\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n\r\nimport Constants from '../streaming/constants/Constants';\r\nimport DashConstants from './constants/DashConstants';\r\nimport RepresentationInfo from '../streaming/vo/RepresentationInfo';\r\nimport MediaInfo from '../streaming/vo/MediaInfo';\r\nimport StreamInfo from '../streaming/vo/StreamInfo';\r\nimport ManifestInfo from '../streaming/vo/ManifestInfo';\r\nimport Event from './vo/Event';\r\nimport FactoryMaker from '../core/FactoryMaker';\r\nimport cea608parser from '../../externals/cea608-parser';\r\nimport { checkInteger } from '../streaming/utils/SupervisorTools';\r\n\r\nfunction DashAdapter() {\r\n    let instance,\r\n        dashManifestModel,\r\n        voPeriods,\r\n        voAdaptations,\r\n        currentMediaInfo;\r\n\r\n    function setup() {\r\n        reset();\r\n    }\r\n\r\n    function setConfig(config) {\r\n        if (!config) return;\r\n\r\n        if (config.dashManifestModel) {\r\n            dashManifestModel = config.dashManifestModel;\r\n        }\r\n    }\r\n\r\n    function getRepresentationForRepresentationInfo(representationInfo, representationController) {\r\n        return representationController && representationInfo ? representationController.getRepresentationForQuality(representationInfo.quality) : null;\r\n    }\r\n\r\n    function getAdaptationForMediaInfo(mediaInfo) {\r\n\r\n        if (!mediaInfo || !mediaInfo.streamInfo || mediaInfo.streamInfo.id === undefined || !voAdaptations[mediaInfo.streamInfo.id]) return null;\r\n        return voAdaptations[mediaInfo.streamInfo.id][mediaInfo.index];\r\n    }\r\n\r\n    function getPeriodForStreamInfo(streamInfo, voPeriodsArray) {\r\n        const ln = voPeriodsArray.length;\r\n\r\n        for (let i = 0; i < ln; i++) {\r\n            let voPeriod = voPeriodsArray[i];\r\n\r\n            if (streamInfo.id === voPeriod.id) return voPeriod;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    function convertRepresentationToRepresentationInfo(voRepresentation) {\r\n        let representationInfo = new RepresentationInfo();\r\n        const realAdaptation = voRepresentation.adaptation.period.mpd.manifest.Period_asArray[voRepresentation.adaptation.period.index].AdaptationSet_asArray[voRepresentation.adaptation.index];\r\n        const realRepresentation = dashManifestModel.getRepresentationFor(voRepresentation.index, realAdaptation);\r\n\r\n        representationInfo.id = voRepresentation.id;\r\n        representationInfo.quality = voRepresentation.index;\r\n        representationInfo.bandwidth = dashManifestModel.getBandwidth(realRepresentation);\r\n        representationInfo.DVRWindow = voRepresentation.segmentAvailabilityRange;\r\n        representationInfo.fragmentDuration = voRepresentation.segmentDuration || (voRepresentation.segments && voRepresentation.segments.length > 0 ? voRepresentation.segments[0].duration : NaN);\r\n        representationInfo.MSETimeOffset = voRepresentation.MSETimeOffset;\r\n        representationInfo.useCalculatedLiveEdgeTime = voRepresentation.useCalculatedLiveEdgeTime;\r\n        representationInfo.mediaInfo = convertAdaptationToMediaInfo(voRepresentation.adaptation);\r\n\r\n        return representationInfo;\r\n    }\r\n\r\n    function convertAdaptationToMediaInfo(adaptation) {\r\n        let mediaInfo = new MediaInfo();\r\n        const realAdaptation = adaptation.period.mpd.manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index];\r\n        let viewpoint;\r\n\r\n        mediaInfo.id = adaptation.id;\r\n        mediaInfo.index = adaptation.index;\r\n        mediaInfo.type = adaptation.type;\r\n        mediaInfo.streamInfo = convertPeriodToStreamInfo(adaptation.period);\r\n        mediaInfo.representationCount = dashManifestModel.getRepresentationCount(realAdaptation);\r\n        mediaInfo.labels = dashManifestModel.getLabelsForAdaptation(realAdaptation);\r\n        mediaInfo.lang = dashManifestModel.getLanguageForAdaptation(realAdaptation);\r\n        viewpoint = dashManifestModel.getViewpointForAdaptation(realAdaptation);\r\n        mediaInfo.viewpoint = viewpoint ? viewpoint.value : undefined;\r\n        mediaInfo.accessibility = dashManifestModel.getAccessibilityForAdaptation(realAdaptation).map(function (accessibility) {\r\n            let accessibilityValue = accessibility.value;\r\n            let accessibilityData = accessibilityValue;\r\n            if (accessibility.schemeIdUri && (accessibility.schemeIdUri.search('cea-608') >= 0) && typeof (cea608parser) !== 'undefined') {\r\n                if (accessibilityValue) {\r\n                    accessibilityData = 'cea-608:' + accessibilityValue;\r\n                } else {\r\n                    accessibilityData = 'cea-608';\r\n                }\r\n                mediaInfo.embeddedCaptions = true;\r\n            }\r\n            return accessibilityData;\r\n        });\r\n\r\n        mediaInfo.audioChannelConfiguration = dashManifestModel.getAudioChannelConfigurationForAdaptation(realAdaptation).map(function (audioChannelConfiguration) {\r\n            return audioChannelConfiguration.value;\r\n        });\r\n        mediaInfo.roles = dashManifestModel.getRolesForAdaptation(realAdaptation).map(function (role) {\r\n            return role.value;\r\n        });\r\n        mediaInfo.codec = dashManifestModel.getCodec(realAdaptation);\r\n        mediaInfo.mimeType = dashManifestModel.getMimeType(realAdaptation);\r\n        mediaInfo.contentProtection = dashManifestModel.getContentProtectionData(realAdaptation);\r\n        mediaInfo.bitrateList = dashManifestModel.getBitrateListForAdaptation(realAdaptation);\r\n\r\n        if (mediaInfo.contentProtection) {\r\n            mediaInfo.contentProtection.forEach(function (item) {\r\n                item.KID = dashManifestModel.getKID(item);\r\n            });\r\n        }\r\n\r\n        mediaInfo.isText = dashManifestModel.getIsTextTrack(mediaInfo.mimeType);\r\n\r\n        return mediaInfo;\r\n    }\r\n\r\n    function convertVideoInfoToEmbeddedTextInfo(mediaInfo, channel, lang) {\r\n        mediaInfo.id = channel; // CC1, CC2, CC3, or CC4\r\n        mediaInfo.index = 100 + parseInt(channel.substring(2, 3));\r\n        mediaInfo.type = Constants.EMBEDDED_TEXT;\r\n        mediaInfo.codec = 'cea-608-in-SEI';\r\n        mediaInfo.isText = true;\r\n        mediaInfo.isEmbedded = true;\r\n        mediaInfo.lang = lang;\r\n        mediaInfo.roles = ['caption'];\r\n    }\r\n\r\n    function convertVideoInfoToThumbnailInfo(mediaInfo) {\r\n        mediaInfo.type = Constants.IMAGE;\r\n    }\r\n\r\n    function convertPeriodToStreamInfo(period) {\r\n        let streamInfo = new StreamInfo();\r\n        const THRESHOLD = 1;\r\n\r\n        streamInfo.id = period.id;\r\n        streamInfo.index = period.index;\r\n        streamInfo.start = period.start;\r\n        streamInfo.duration = period.duration;\r\n        streamInfo.manifestInfo = convertMpdToManifestInfo(period.mpd);\r\n        streamInfo.isLast = period.mpd.manifest.Period_asArray.length === 1 || Math.abs((streamInfo.start + streamInfo.duration) - streamInfo.manifestInfo.duration) < THRESHOLD;\r\n\r\n        return streamInfo;\r\n    }\r\n\r\n    function convertMpdToManifestInfo(mpd) {\r\n        let manifestInfo = new ManifestInfo();\r\n\r\n        manifestInfo.DVRWindowSize = mpd.timeShiftBufferDepth;\r\n        manifestInfo.loadedTime = mpd.manifest.loadedTime;\r\n        manifestInfo.availableFrom = mpd.availabilityStartTime;\r\n        manifestInfo.minBufferTime = mpd.manifest.minBufferTime;\r\n        manifestInfo.maxFragmentDuration = mpd.maxSegmentDuration;\r\n        manifestInfo.duration = dashManifestModel.getDuration(mpd.manifest);\r\n        manifestInfo.isDynamic = dashManifestModel.getIsDynamic(mpd.manifest);\r\n        if (mpd.manifest.protocol) {\r\n            manifestInfo.protocol = mpd.manifest.protocol;\r\n        }\r\n\r\n        return manifestInfo;\r\n    }\r\n\r\n    function getMediaInfoForType(streamInfo, type) {\r\n\r\n        if (voPeriods.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        const manifest = voPeriods[0].mpd.manifest;\r\n        let realAdaptation = getAdaptationForType(manifest, streamInfo.index, type, streamInfo);\r\n        if (!realAdaptation) return null;\r\n\r\n        let selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voPeriods);\r\n        let periodId = selectedVoPeriod.id;\r\n        let idx = dashManifestModel.getIndexForAdaptation(realAdaptation, manifest, streamInfo.index);\r\n\r\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\r\n\r\n        return convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\r\n    }\r\n\r\n    function getIsMain(adaptation) {\r\n        return dashManifestModel.getRolesForAdaptation(adaptation).filter(function (role) {\r\n            return role.value === DashConstants.MAIN;\r\n        })[0];\r\n    }\r\n\r\n    function getAdaptationForType(manifest, periodIndex, type, streamInfo) {\r\n        const adaptations = dashManifestModel.getAdaptationsForType(manifest, periodIndex, type);\r\n\r\n        if (!adaptations || adaptations.length === 0) return null;\r\n\r\n        if (adaptations.length > 1 && streamInfo) {\r\n            const allMediaInfoForType = getAllMediaInfoForType(streamInfo, type);\r\n\r\n            if (currentMediaInfo[streamInfo.id] && currentMediaInfo[streamInfo.id][type]) {\r\n                for (let i = 0, ln = adaptations.length; i < ln; i++) {\r\n                    if (currentMediaInfo[streamInfo.id][type].isMediaInfoEqual(allMediaInfoForType[i])) {\r\n                        return adaptations[i];\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i = 0, ln = adaptations.length; i < ln; i++) {\r\n                if (getIsMain(adaptations[i])) {\r\n                    return adaptations[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        return adaptations[0];\r\n    }\r\n\r\n    function getAllMediaInfoForType(streamInfo, type, externalManifest) {\r\n        let voLocalPeriods = voPeriods;\r\n        let manifest = externalManifest;\r\n        let mediaArr = [];\r\n        let data,\r\n            media,\r\n            idx,\r\n            i,\r\n            j,\r\n            ln;\r\n\r\n        if (manifest) {\r\n            checkSetConfigCall();\r\n            const mpd = dashManifestModel.getMpd(manifest);\r\n\r\n            voLocalPeriods = dashManifestModel.getRegularPeriods(mpd);\r\n        } else {\r\n            if (voPeriods.length > 0) {\r\n                manifest = voPeriods[0].mpd.manifest;\r\n            } else {\r\n                return mediaArr;\r\n            }\r\n        }\r\n\r\n        const selectedVoPeriod = getPeriodForStreamInfo(streamInfo, voLocalPeriods);\r\n        const periodId = selectedVoPeriod.id;\r\n        const adaptationsForType = dashManifestModel.getAdaptationsForType(manifest, streamInfo.index, type !== Constants.EMBEDDED_TEXT ? type : Constants.VIDEO);\r\n\r\n        if (!adaptationsForType) return mediaArr;\r\n\r\n        voAdaptations[periodId] = voAdaptations[periodId] || dashManifestModel.getAdaptationsForPeriod(selectedVoPeriod);\r\n\r\n        for (i = 0, ln = adaptationsForType.length; i < ln; i++) {\r\n            data = adaptationsForType[i];\r\n            idx = dashManifestModel.getIndexForAdaptation(data, manifest, streamInfo.index);\r\n            media = convertAdaptationToMediaInfo(voAdaptations[periodId][idx]);\r\n\r\n            if (type === Constants.EMBEDDED_TEXT) {\r\n                let accessibilityLength = media.accessibility.length;\r\n                for (j = 0; j < accessibilityLength; j++) {\r\n                    if (!media) {\r\n                        continue;\r\n                    }\r\n                    let accessibility = media.accessibility[j];\r\n                    if (accessibility.indexOf('cea-608:') === 0) {\r\n                        let value = accessibility.substring(8);\r\n                        let parts = value.split(';');\r\n                        if (parts[0].substring(0, 2) === 'CC') {\r\n                            for (j = 0; j < parts.length; j++) {\r\n                                if (!media) {\r\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\r\n                                }\r\n                                convertVideoInfoToEmbeddedTextInfo(media, parts[j].substring(0, 3), parts[j].substring(4));\r\n                                mediaArr.push(media);\r\n                                media = null;\r\n                            }\r\n                        } else {\r\n                            for (j = 0; j < parts.length; j++) { // Only languages for CC1, CC2, ...\r\n                                if (!media) {\r\n                                    media = convertAdaptationToMediaInfo.call(this, voAdaptations[periodId][idx]);\r\n                                }\r\n                                convertVideoInfoToEmbeddedTextInfo(media, 'CC' + (j + 1), parts[j]);\r\n                                mediaArr.push(media);\r\n                                media = null;\r\n                            }\r\n                        }\r\n                    } else if (accessibility.indexOf('cea-608') === 0) { // Nothing known. We interpret it as CC1=eng\r\n                        convertVideoInfoToEmbeddedTextInfo(media, Constants.CC1, 'eng');\r\n                        mediaArr.push(media);\r\n                        media = null;\r\n                    }\r\n                }\r\n            } else if (type === Constants.IMAGE) {\r\n                convertVideoInfoToThumbnailInfo(media);\r\n                mediaArr.push(media);\r\n                media = null;\r\n            } else if (media) {\r\n                mediaArr.push(media);\r\n            }\r\n        }\r\n\r\n        return mediaArr;\r\n    }\r\n\r\n    function checkSetConfigCall() {\r\n        if (!dashManifestModel || !dashManifestModel.hasOwnProperty('getMpd') || !dashManifestModel.hasOwnProperty('getRegularPeriods')) {\r\n            throw new Error('setConfig function has to be called previously');\r\n        }\r\n    }\r\n\r\n    function updatePeriods(newManifest) {\r\n        if (!newManifest) return null;\r\n\r\n        checkSetConfigCall();\r\n\r\n        const mpd = dashManifestModel.getMpd(newManifest);\r\n\r\n        voPeriods = dashManifestModel.getRegularPeriods(mpd);\r\n        voAdaptations = {};\r\n    }\r\n\r\n    function getStreamsInfo(externalManifest, maxStreamsInfo) {\r\n        const streams = [];\r\n        let voLocalPeriods = voPeriods;\r\n\r\n        //if manifest is defined, getStreamsInfo is for an outside manifest, not the current one\r\n        if (externalManifest) {\r\n            checkSetConfigCall();\r\n            const mpd = dashManifestModel.getMpd(externalManifest);\r\n\r\n            voLocalPeriods = dashManifestModel.getRegularPeriods(mpd);\r\n        }\r\n\r\n        if (!maxStreamsInfo) {\r\n            maxStreamsInfo = voLocalPeriods.length;\r\n        }\r\n        for (let i = 0; i < maxStreamsInfo; i++) {\r\n            streams.push(convertPeriodToStreamInfo(voLocalPeriods[i]));\r\n        }\r\n\r\n        return streams;\r\n    }\r\n\r\n    function checkStreamProcessor(streamProcessor) {\r\n        if (!streamProcessor || !streamProcessor.hasOwnProperty('getRepresentationController') || !streamProcessor.hasOwnProperty('getIndexHandler') ||\r\n            !streamProcessor.hasOwnProperty('getMediaInfo') || !streamProcessor.hasOwnProperty('getType') || !streamProcessor.hasOwnProperty('getStreamInfo')) {\r\n            throw new Error('streamProcessor parameter is missing or malformed!');\r\n        }\r\n    }\r\n\r\n    function checkRepresentationController(representationController) {\r\n        if (!representationController || !representationController.hasOwnProperty('getRepresentationForQuality') || !representationController.hasOwnProperty('getCurrentRepresentation')) {\r\n            throw new Error('representationController parameter is missing or malformed!');\r\n        }\r\n    }\r\n\r\n    function getInitRequest(streamProcessor, quality) {\r\n        let representationController,\r\n            representation,\r\n            indexHandler;\r\n\r\n        checkStreamProcessor(streamProcessor);\r\n        checkInteger(quality);\r\n\r\n        representationController = streamProcessor.getRepresentationController();\r\n        indexHandler = streamProcessor.getIndexHandler();\r\n\r\n        representation = representationController ? representationController.getRepresentationForQuality(quality) : null;\r\n\r\n        return indexHandler ? indexHandler.getInitRequest(representation) : null;\r\n    }\r\n\r\n    function getFragmentRequest(streamProcessor, representationInfo, time, options) {\r\n        let representationController,\r\n            representation,\r\n            indexHandler;\r\n\r\n        let fragRequest = null;\r\n\r\n        checkStreamProcessor(streamProcessor);\r\n\r\n        representationController = streamProcessor.getRepresentationController();\r\n        representation = getRepresentationForRepresentationInfo(representationInfo, representationController);\r\n        indexHandler = streamProcessor.getIndexHandler();\r\n\r\n        if (indexHandler) {\r\n            //if time and options are undefined, it means the next segment is requested\r\n            //otherwise, the segment at this specific time is requested.\r\n            if (time !== undefined && options !== undefined) {\r\n                fragRequest = indexHandler.getSegmentRequestForTime(representation, time, options);\r\n            } else {\r\n                fragRequest = indexHandler.getNextSegmentRequest(representation);\r\n            }\r\n        }\r\n\r\n        return fragRequest;\r\n    }\r\n\r\n    function getIndexHandlerTime(streamProcessor) {\r\n        checkStreamProcessor(streamProcessor);\r\n\r\n        const indexHandler = streamProcessor.getIndexHandler();\r\n\r\n        return indexHandler ? indexHandler.getCurrentTime() : NaN;\r\n    }\r\n\r\n    function setIndexHandlerTime(streamProcessor, value) {\r\n        checkStreamProcessor(streamProcessor);\r\n\r\n        const indexHandler = streamProcessor.getIndexHandler();\r\n        if (indexHandler) {\r\n            indexHandler.setCurrentTime(value);\r\n        }\r\n    }\r\n\r\n    function resetIndexHandler(streamProcessor) {\r\n        checkStreamProcessor(streamProcessor);\r\n\r\n        const indexHandler = streamProcessor.getIndexHandler();\r\n        if (indexHandler) {\r\n            indexHandler.resetIndex();\r\n        }\r\n    }\r\n\r\n    function updateData(streamProcessor) {\r\n        checkStreamProcessor(streamProcessor);\r\n\r\n        const selectedVoPeriod = getPeriodForStreamInfo(streamProcessor.getStreamInfo(), voPeriods);\r\n        const mediaInfo = streamProcessor.getMediaInfo();\r\n        const voAdaptation = getAdaptationForMediaInfo(mediaInfo);\r\n        const type = streamProcessor.getType();\r\n\r\n        let id,\r\n            realAdaptation;\r\n\r\n        id = mediaInfo ? mediaInfo.id : null;\r\n        if (voPeriods.length > 0) {\r\n            realAdaptation = id ? dashManifestModel.getAdaptationForId(id, voPeriods[0].mpd.manifest, selectedVoPeriod.index) : dashManifestModel.getAdaptationForIndex(mediaInfo.index, voPeriods[0].mpd.manifest, selectedVoPeriod.index);\r\n            streamProcessor.getRepresentationController().updateData(realAdaptation, voAdaptation, type);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get a specific voRepresentation. If quality parameter is defined, this function will return the voRepresentation for this quality.\r\n     * Otherwise, this function will return the current voRepresentation used by the representationController.\r\n     * @param {RepresentationController} representationController - RepresentationController reference\r\n     * @param {number} quality - quality index of the voRepresentaion expected.\r\n     */\r\n    function getRepresentationInfo(representationController, quality) {\r\n        checkRepresentationController(representationController);\r\n        let voRepresentation;\r\n\r\n        if (quality !== undefined) {\r\n            checkInteger(quality);\r\n            voRepresentation = representationController.getRepresentationForQuality(quality);\r\n        } else {\r\n            voRepresentation = representationController.getCurrentRepresentation();\r\n        }\r\n\r\n        return voRepresentation ? convertRepresentationToRepresentationInfo(voRepresentation) : null;\r\n    }\r\n\r\n    function getEvent(eventBox, eventStreams, startTime) {\r\n        if (!eventBox || !eventStreams) {\r\n            return null;\r\n        }\r\n        const event = new Event();\r\n        const schemeIdUri = eventBox.scheme_id_uri;\r\n        const value = eventBox.value;\r\n        const timescale = eventBox.timescale;\r\n        const presentationTimeDelta = eventBox.presentation_time_delta;\r\n        const duration = eventBox.event_duration;\r\n        const id = eventBox.id;\r\n        const messageData = eventBox.message_data;\r\n        const presentationTime = startTime * timescale + presentationTimeDelta;\r\n\r\n        if (!eventStreams[schemeIdUri + '/' + value]) return null;\r\n\r\n        event.eventStream = eventStreams[schemeIdUri + '/' + value];\r\n        event.eventStream.value = value;\r\n        event.eventStream.timescale = timescale;\r\n        event.duration = duration;\r\n        event.id = id;\r\n        event.presentationTime = presentationTime;\r\n        event.messageData = messageData;\r\n        event.presentationTimeDelta = presentationTimeDelta;\r\n\r\n        return event;\r\n    }\r\n\r\n    function getEventsFor(info, streamProcessor) {\r\n        let events = [];\r\n\r\n        if (voPeriods.length === 0) {\r\n            return events;\r\n        }\r\n\r\n        const manifest = voPeriods[0].mpd.manifest;\r\n\r\n        if (info instanceof StreamInfo) {\r\n            events = dashManifestModel.getEventsForPeriod(getPeriodForStreamInfo(info, voPeriods));\r\n        } else if (info instanceof MediaInfo) {\r\n            events = dashManifestModel.getEventStreamForAdaptationSet(manifest, getAdaptationForMediaInfo(info));\r\n        } else if (info instanceof RepresentationInfo) {\r\n            events = dashManifestModel.getEventStreamForRepresentation(manifest, getRepresentationForRepresentationInfo(info, streamProcessor.getRepresentationController()));\r\n        }\r\n\r\n        return events;\r\n    }\r\n\r\n    function setCurrentMediaInfo(streamId, type, mediaInfo) {\r\n        currentMediaInfo[streamId] = currentMediaInfo[streamId] || {};\r\n        currentMediaInfo[streamId][type] = currentMediaInfo[streamId][type] || {};\r\n        currentMediaInfo[streamId][type] = mediaInfo;\r\n    }\r\n\r\n    function reset() {\r\n        voPeriods = [];\r\n        voAdaptations = {};\r\n        currentMediaInfo = {};\r\n    }\r\n\r\n    instance = {\r\n        convertDataToRepresentationInfo: convertRepresentationToRepresentationInfo,\r\n        getDataForMedia: getAdaptationForMediaInfo,\r\n        getStreamsInfo: getStreamsInfo,\r\n        getMediaInfoForType: getMediaInfoForType,\r\n        getAllMediaInfoForType: getAllMediaInfoForType,\r\n        getRepresentationInfo: getRepresentationInfo,\r\n        getAdaptationForType: getAdaptationForType,\r\n        updateData: updateData,\r\n        getInitRequest: getInitRequest,\r\n        getFragmentRequest: getFragmentRequest,\r\n        getIndexHandlerTime: getIndexHandlerTime,\r\n        setIndexHandlerTime: setIndexHandlerTime,\r\n        getEventsFor: getEventsFor,\r\n        getEvent: getEvent,\r\n        setConfig: setConfig,\r\n        updatePeriods: updatePeriods,\r\n        reset: reset,\r\n        resetIndexHandler: resetIndexHandler,\r\n        setCurrentMediaInfo: setCurrentMediaInfo\r\n    };\r\n\r\n    setup();\r\n    return instance;\r\n}\r\n\r\nDashAdapter.__dashjs_factory_name = 'DashAdapter';\r\nexport default FactoryMaker.getSingletonFactory(DashAdapter);\r\n"]}