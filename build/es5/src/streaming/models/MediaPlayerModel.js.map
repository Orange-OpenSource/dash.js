{"version":3,"sources":["../../../../../src/streaming/models/MediaPlayerModel.js"],"names":["LIVE_DELAY_FRAGMENT_COUNT","DEFAULT_LOCAL_STORAGE_BITRATE_EXPIRATION","DEFAULT_LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION","BANDWIDTH_SAFETY_FACTOR","ABANDON_LOAD_TIMEOUT","BUFFER_TO_KEEP","BUFFER_AHEAD_TO_KEEP","BUFFER_PRUNING_INTERVAL","DEFAULT_MIN_BUFFER_TIME","DEFAULT_MIN_BUFFER_TIME_FAST_SWITCH","BUFFER_TIME_AT_TOP_QUALITY","BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM","LONG_FORM_CONTENT_DURATION_THRESHOLD","SEGMENT_OVERLAP_TOLERANCE_TIME","SMALL_GAP_LIMIT","MANIFEST_UPDATE_RETRY_INTERVAL","CACHE_LOAD_THRESHOLD_VIDEO","CACHE_LOAD_THRESHOLD_AUDIO","FRAGMENT_RETRY_ATTEMPTS","FRAGMENT_RETRY_INTERVAL","MANIFEST_RETRY_ATTEMPTS","MANIFEST_RETRY_INTERVAL","XLINK_RETRY_ATTEMPTS","XLINK_RETRY_INTERVAL","DEFAULT_LOW_LATENCY_LIVE_DELAY","LOW_LATENCY_REDUCTION_FACTOR","LOW_LATENCY_MULTIPLY_FACTOR","LOW_LATENCY_CATCH_UP_MIN_DRIFT","LOW_LATENCY_CATCH_UP_MAX_DRIFT","LOW_LATENCY_CATCH_UP_PLAYBACK_RATE","WALLCLOCK_TIME_UPDATE_INTERVAL","DEFAULT_XHR_WITH_CREDENTIALS","MediaPlayerModel","instance","useManifestDateHeaderTimeSource","useSuggestedPresentationDelay","UTCTimingSources","liveDelayFragmentCount","liveDelay","scheduleWhilePaused","bufferToKeep","bufferAheadToKeep","bufferPruningInterval","lastBitrateCachingInfo","lastMediaSettingsCachingInfo","stableBufferTime","bufferTimeAtTopQuality","bufferTimeAtTopQualityLongForm","longFormContentDurationThreshold","segmentOverlapToleranceTime","bandwidthSafetyFactor","abandonLoadTimeout","retryAttempts","retryIntervals","wallclockTimeUpdateInterval","ABRStrategy","useDefaultABRRules","xhrWithCredentials","fastSwitchEnabled","customABRRule","movingAverageMethod","cacheLoadThresholds","jumpGaps","smallGapLimit","lowLatencyEnabled","manifestUpdateRetryInterval","keepProtectionMediaKeys","liveCatchUpMinDrift","liveCatchUpMaxDrift","liveCatchUpPlaybackRate","DEFAULT_UTC_TIMING_SOURCE","scheme","value","setup","Constants","ABR_STRATEGY_DYNAMIC","enabled","ttl","undefined","NaN","default","MOVING_AVERAGE_SLIDING_WINDOW","HTTPRequest","MPD_TYPE","XLINK_EXPANSION_TYPE","MEDIA_SEGMENT_TYPE","INIT_SEGMENT_TYPE","BITSTREAM_SWITCHING_SEGMENT_TYPE","INDEX_SEGMENT_TYPE","OTHER_TYPE","VIDEO","AUDIO","setABRStrategy","ABR_STRATEGY_BOLA","ABR_STRATEGY_THROUGHPUT","BAD_ARGUMENT_ERROR","getABRStrategy","setUseDefaultABRRules","getUseDefaultABRRules","findABRCustomRuleIndex","rulename","i","length","getABRCustomRules","addABRCustomRule","type","rule","ABRRulesCollection","ABANDON_FRAGMENT_RULES","QUALITY_SWITCH_RULES","index","push","removeABRCustomRule","splice","setBandwidthSafetyFactor","getBandwidthSafetyFactor","setAbandonLoadTimeout","getAbandonLoadTimeout","setStableBufferTime","getStableBufferTime","getLowLatencyEnabled","getLiveDelay","isNaN","setBufferTimeAtTopQuality","getBufferTimeAtTopQuality","setBufferTimeAtTopQualityLongForm","getBufferTimeAtTopQualityLongForm","setLongFormContentDurationThreshold","getLongFormContentDurationThreshold","setSegmentOverlapToleranceTime","getSegmentOverlapToleranceTime","setCacheLoadThresholdForType","getCacheLoadThresholdForType","setBufferToKeep","getBufferToKeep","setBufferAheadToKeep","getBufferAheadToKeep","setLastBitrateCachingInfo","enable","getLastBitrateCachingInfo","setLastMediaSettingsCachingInfo","getLastMediaSettingsCachingInfo","setBufferPruningInterval","getBufferPruningInterval","setRetryAttemptsForType","getRetryAttemptsForType","setRetryIntervalForType","getRetryIntervalForType","setWallclockTimeUpdateInterval","getWallclockTimeUpdateInterval","setScheduleWhilePaused","getScheduleWhilePaused","setLiveDelayFragmentCount","getLiveDelayFragmentCount","setLiveDelay","setUseManifestDateHeaderTimeSource","getUseManifestDateHeaderTimeSource","setUseSuggestedPresentationDelay","getUseSuggestedPresentationDelay","addUTCTimingSource","schemeIdUri","removeUTCTimingSource","vo","UTCTiming","getUTCTimingSources","forEach","obj","idx","clearDefaultUTCTimingSources","restoreDefaultUTCTimingSources","setXHRWithCredentialsForType","Object","keys","key","getXHRWithCredentialsForType","useCreds","getFastSwitchEnabled","setFastSwitchEnabled","setMovingAverageMethod","MOVING_AVERAGE_EWMA","getMovingAverageMethod","setJumpGaps","getJumpGaps","setSmallGapLimit","getSmallGapLimit","setLowLatencyEnabled","setCatchUpPlaybackRate","getCatchUpPlaybackRate","setLowLatencyMinDrift","getLowLatencyMinDrift","setLowLatencyMaxDriftBeforeSeeking","getLowLatencyMaxDriftBeforeSeeking","setManifestUpdateRetryInterval","getManifestUpdateRetryInterval","setKeepProtectionMediaKeys","getKeepProtectionMediaKeys","getDefaultUtcTimingSource","reset","__dashjs_factory_name","FactoryMaker","getSingletonFactory"],"mappings":"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","file":"MediaPlayerModel.js","sourcesContent":["/**\n * The copyright in this software is being made available under the BSD License,\n * included below. This software may be subject to other third party and contributor\n * rights, including patent rights, and no such rights are granted under this license.\n *\n * Copyright (c) 2013, Dash Industry Forum.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without modification,\n * are permitted provided that the following conditions are met:\n *  * Redistributions of source code must retain the above copyright notice, this\n *  list of conditions and the following disclaimer.\n *  * Redistributions in binary form must reproduce the above copyright notice,\n *  this list of conditions and the following disclaimer in the documentation and/or\n *  other materials provided with the distribution.\n *  * Neither the name of Dash Industry Forum nor the names of its\n *  contributors may be used to endorse or promote products derived from this software\n *  without specific prior written permission.\n *\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS AS IS AND ANY\n *  EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n *  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n *  INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT\n *  NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n *  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n *  POSSIBILITY OF SUCH DAMAGE.\n */\nimport UTCTiming from '../../dash/vo/UTCTiming';\nimport FactoryMaker from '../../core/FactoryMaker';\nimport {\n    HTTPRequest\n}\nfrom '../vo/metrics/HTTPRequest';\nimport Constants from '../constants/Constants';\nimport ABRRulesCollection from '../rules/abr/ABRRulesCollection';\nimport { checkParameterType, checkRange, checkIsVideoOrAudioType } from '../utils/SupervisorTools';\n\nconst LIVE_DELAY_FRAGMENT_COUNT = 4;\n\nconst DEFAULT_LOCAL_STORAGE_BITRATE_EXPIRATION = 360000;\nconst DEFAULT_LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION = 360000;\n\nconst BANDWIDTH_SAFETY_FACTOR = 0.9;\nconst ABANDON_LOAD_TIMEOUT = 10000;\n\nconst BUFFER_TO_KEEP = 20;\nconst BUFFER_AHEAD_TO_KEEP = 80;\nconst BUFFER_PRUNING_INTERVAL = 10;\nconst DEFAULT_MIN_BUFFER_TIME = 12;\nconst DEFAULT_MIN_BUFFER_TIME_FAST_SWITCH = 20;\nconst BUFFER_TIME_AT_TOP_QUALITY = 30;\nconst BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM = 60;\nconst LONG_FORM_CONTENT_DURATION_THRESHOLD = 600;\nconst SEGMENT_OVERLAP_TOLERANCE_TIME = 0.2;\nconst SMALL_GAP_LIMIT = 0.8;\nconst MANIFEST_UPDATE_RETRY_INTERVAL = 100;\n\nconst CACHE_LOAD_THRESHOLD_VIDEO = 50;\nconst CACHE_LOAD_THRESHOLD_AUDIO = 5;\n\nconst FRAGMENT_RETRY_ATTEMPTS = 3;\nconst FRAGMENT_RETRY_INTERVAL = 1000;\n\nconst MANIFEST_RETRY_ATTEMPTS = 3;\nconst MANIFEST_RETRY_INTERVAL = 500;\n\nconst XLINK_RETRY_ATTEMPTS = 1;\nconst XLINK_RETRY_INTERVAL = 500;\n\nconst DEFAULT_LOW_LATENCY_LIVE_DELAY = 3.0;\nconst LOW_LATENCY_REDUCTION_FACTOR = 10;\nconst LOW_LATENCY_MULTIPLY_FACTOR = 5;\nconst LOW_LATENCY_CATCH_UP_MIN_DRIFT = 0.02;\nconst LOW_LATENCY_CATCH_UP_MAX_DRIFT = 0;\nconst LOW_LATENCY_CATCH_UP_PLAYBACK_RATE = 0.5;\n\n//This value influences the startup time for live (in ms).\nconst WALLCLOCK_TIME_UPDATE_INTERVAL = 50;\n\nconst DEFAULT_XHR_WITH_CREDENTIALS = false;\n\nfunction MediaPlayerModel() {\n\n    let instance,\n        useManifestDateHeaderTimeSource,\n        useSuggestedPresentationDelay,\n        UTCTimingSources,\n        liveDelayFragmentCount,\n        liveDelay,\n        scheduleWhilePaused,\n        bufferToKeep,\n        bufferAheadToKeep,\n        bufferPruningInterval,\n        lastBitrateCachingInfo,\n        lastMediaSettingsCachingInfo,\n        stableBufferTime,\n        bufferTimeAtTopQuality,\n        bufferTimeAtTopQualityLongForm,\n        longFormContentDurationThreshold,\n        segmentOverlapToleranceTime,\n        bandwidthSafetyFactor,\n        abandonLoadTimeout,\n        retryAttempts,\n        retryIntervals,\n        wallclockTimeUpdateInterval,\n        ABRStrategy,\n        useDefaultABRRules,\n        xhrWithCredentials,\n        fastSwitchEnabled,\n        customABRRule,\n        movingAverageMethod,\n        cacheLoadThresholds,\n        jumpGaps,\n        smallGapLimit,\n        lowLatencyEnabled,\n        manifestUpdateRetryInterval,\n        keepProtectionMediaKeys,\n        liveCatchUpMinDrift,\n        liveCatchUpMaxDrift,\n        liveCatchUpPlaybackRate;\n\n    const DEFAULT_UTC_TIMING_SOURCE = {\n            scheme: 'urn:mpeg:dash:utc:http-xsdate:2014',\n            value: 'http://time.akamai.com/?iso&ms'\n        };\n\n    function setup() {\n        UTCTimingSources = [];\n        useSuggestedPresentationDelay = false;\n        useManifestDateHeaderTimeSource = true;\n        scheduleWhilePaused = true;\n        ABRStrategy = Constants.ABR_STRATEGY_DYNAMIC;\n        useDefaultABRRules = true;\n        fastSwitchEnabled = false;\n        lastBitrateCachingInfo = {\n            enabled: true,\n            ttl: DEFAULT_LOCAL_STORAGE_BITRATE_EXPIRATION\n        };\n        lastMediaSettingsCachingInfo = {\n            enabled: true,\n            ttl: DEFAULT_LOCAL_STORAGE_MEDIA_SETTINGS_EXPIRATION\n        };\n        liveDelayFragmentCount = LIVE_DELAY_FRAGMENT_COUNT;\n        liveDelay = undefined; // Explicitly state that default is undefined\n        bufferToKeep = BUFFER_TO_KEEP;\n        bufferAheadToKeep = BUFFER_AHEAD_TO_KEEP;\n        bufferPruningInterval = BUFFER_PRUNING_INTERVAL;\n        stableBufferTime = NaN;\n        bufferTimeAtTopQuality = BUFFER_TIME_AT_TOP_QUALITY;\n        bufferTimeAtTopQualityLongForm = BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM;\n        longFormContentDurationThreshold = LONG_FORM_CONTENT_DURATION_THRESHOLD;\n        segmentOverlapToleranceTime = SEGMENT_OVERLAP_TOLERANCE_TIME;\n        bandwidthSafetyFactor = BANDWIDTH_SAFETY_FACTOR;\n        abandonLoadTimeout = ABANDON_LOAD_TIMEOUT;\n        wallclockTimeUpdateInterval = WALLCLOCK_TIME_UPDATE_INTERVAL;\n        jumpGaps = false;\n        smallGapLimit = SMALL_GAP_LIMIT;\n        manifestUpdateRetryInterval = MANIFEST_UPDATE_RETRY_INTERVAL;\n        xhrWithCredentials = {\n            default: DEFAULT_XHR_WITH_CREDENTIALS\n        };\n        customABRRule = [];\n        movingAverageMethod = Constants.MOVING_AVERAGE_SLIDING_WINDOW;\n        lowLatencyEnabled = false;\n        liveCatchUpMinDrift = LOW_LATENCY_CATCH_UP_MIN_DRIFT;\n        liveCatchUpMaxDrift = LOW_LATENCY_CATCH_UP_MAX_DRIFT;\n        liveCatchUpPlaybackRate = LOW_LATENCY_CATCH_UP_PLAYBACK_RATE;\n\n        retryAttempts = {\n            [HTTPRequest.MPD_TYPE]:                         MANIFEST_RETRY_ATTEMPTS,\n            [HTTPRequest.XLINK_EXPANSION_TYPE]:             XLINK_RETRY_ATTEMPTS,\n            [HTTPRequest.MEDIA_SEGMENT_TYPE]:               FRAGMENT_RETRY_ATTEMPTS,\n            [HTTPRequest.INIT_SEGMENT_TYPE]:                FRAGMENT_RETRY_ATTEMPTS,\n            [HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE]: FRAGMENT_RETRY_ATTEMPTS,\n            [HTTPRequest.INDEX_SEGMENT_TYPE]:               FRAGMENT_RETRY_ATTEMPTS,\n            [HTTPRequest.OTHER_TYPE]:                       FRAGMENT_RETRY_ATTEMPTS\n        };\n\n        retryIntervals = {\n            [HTTPRequest.MPD_TYPE]:                         MANIFEST_RETRY_INTERVAL,\n            [HTTPRequest.XLINK_EXPANSION_TYPE]:             XLINK_RETRY_INTERVAL,\n            [HTTPRequest.MEDIA_SEGMENT_TYPE]:               FRAGMENT_RETRY_INTERVAL,\n            [HTTPRequest.INIT_SEGMENT_TYPE]:                FRAGMENT_RETRY_INTERVAL,\n            [HTTPRequest.BITSTREAM_SWITCHING_SEGMENT_TYPE]: FRAGMENT_RETRY_INTERVAL,\n            [HTTPRequest.INDEX_SEGMENT_TYPE]:               FRAGMENT_RETRY_INTERVAL,\n            [HTTPRequest.OTHER_TYPE]:                       FRAGMENT_RETRY_INTERVAL\n        };\n\n        cacheLoadThresholds = {};\n        cacheLoadThresholds[Constants.VIDEO] = CACHE_LOAD_THRESHOLD_VIDEO;\n        cacheLoadThresholds[Constants.AUDIO] = CACHE_LOAD_THRESHOLD_AUDIO;\n\n        keepProtectionMediaKeys = false;\n    }\n\n    //TODO Should we use Object.define to have setters/getters? makes more readable code on other side.\n\n    function setABRStrategy(value) {\n        if (value === Constants.ABR_STRATEGY_DYNAMIC || value === Constants.ABR_STRATEGY_BOLA || value === Constants.ABR_STRATEGY_THROUGHPUT) {\n            ABRStrategy = value;\n        } else {\n            throw Constants.BAD_ARGUMENT_ERROR;\n        }\n    }\n\n    function getABRStrategy() {\n        return ABRStrategy;\n    }\n\n    function setUseDefaultABRRules(value) {\n        checkParameterType(value, 'boolean');\n        useDefaultABRRules = value;\n    }\n\n    function getUseDefaultABRRules() {\n        return useDefaultABRRules;\n    }\n\n    function findABRCustomRuleIndex(rulename) {\n        let i;\n        for (i = 0; i < customABRRule.length; i++) {\n            if (customABRRule[i].rulename === rulename) {\n                return i;\n            }\n        }\n        return -1;\n    }\n\n    function getABRCustomRules() {\n        return customABRRule;\n    }\n\n    function addABRCustomRule(type, rulename, rule) {\n        if (typeof type !== 'string' || (type !== ABRRulesCollection.ABANDON_FRAGMENT_RULES && type !== ABRRulesCollection.QUALITY_SWITCH_RULES) ||\n            typeof rulename !== 'string') {\n            throw Constants.BAD_ARGUMENT_ERROR;\n        }\n        let index = findABRCustomRuleIndex(rulename);\n        if (index === -1) {\n            // add rule\n            customABRRule.push({\n                type: type,\n                rulename: rulename,\n                rule: rule\n            });\n        } else {\n            // update rule\n            customABRRule[index].type = type;\n            customABRRule[index].rule = rule;\n        }\n    }\n\n    function removeABRCustomRule(rulename) {\n        if (rulename) {\n            let index = findABRCustomRuleIndex(rulename);\n            //if no rulename custom rule has been found, do nothing\n            if (index !== -1) {\n                // remove rule\n                customABRRule.splice(index, 1);\n            }\n        } else {\n            //if no rulename is defined, remove all ABR custome rules\n            customABRRule = [];\n        }\n    }\n\n    function setBandwidthSafetyFactor(value) {\n        checkParameterType(value, 'number');\n        bandwidthSafetyFactor = value;\n    }\n\n    function getBandwidthSafetyFactor() {\n        return bandwidthSafetyFactor;\n    }\n\n    function setAbandonLoadTimeout(value) {\n        checkParameterType(value, 'number');\n        abandonLoadTimeout = value;\n    }\n\n    function getAbandonLoadTimeout() {\n        return abandonLoadTimeout;\n    }\n\n    function setStableBufferTime(value) {\n        checkParameterType(value, 'number');\n        stableBufferTime = value;\n    }\n\n    function getStableBufferTime() {\n        if (getLowLatencyEnabled()) {\n            return getLiveDelay() * 0.6;\n        }\n        return !isNaN(stableBufferTime) ? stableBufferTime : fastSwitchEnabled ? DEFAULT_MIN_BUFFER_TIME_FAST_SWITCH : DEFAULT_MIN_BUFFER_TIME;\n    }\n\n    function setBufferTimeAtTopQuality(value) {\n        checkParameterType(value, 'number');\n        bufferTimeAtTopQuality = value;\n    }\n\n    function getBufferTimeAtTopQuality() {\n        return bufferTimeAtTopQuality;\n    }\n\n    function setBufferTimeAtTopQualityLongForm(value) {\n        checkParameterType(value, 'number');\n        bufferTimeAtTopQualityLongForm = value;\n    }\n\n    function getBufferTimeAtTopQualityLongForm() {\n        return bufferTimeAtTopQualityLongForm;\n    }\n\n    function setLongFormContentDurationThreshold(value) {\n        checkParameterType(value, 'number');\n        longFormContentDurationThreshold = value;\n    }\n\n    function getLongFormContentDurationThreshold() {\n        return longFormContentDurationThreshold;\n    }\n\n    function setSegmentOverlapToleranceTime(value) {\n        checkParameterType(value, 'number');\n        segmentOverlapToleranceTime = value;\n    }\n\n    function getSegmentOverlapToleranceTime() {\n        return segmentOverlapToleranceTime;\n    }\n\n    function setCacheLoadThresholdForType(type, value) {\n        checkParameterType(value, 'number');\n        checkIsVideoOrAudioType(type);\n        cacheLoadThresholds[type] = value;\n    }\n\n    function getCacheLoadThresholdForType(type) {\n        return cacheLoadThresholds[type];\n    }\n\n    function setBufferToKeep(value) {\n        checkParameterType(value, 'number');\n        bufferToKeep = value;\n    }\n\n    function getBufferToKeep() {\n        return bufferToKeep;\n    }\n\n    function setBufferAheadToKeep(value) {\n        checkParameterType(value, 'number');\n        bufferAheadToKeep = value;\n    }\n\n    function getBufferAheadToKeep() {\n        return bufferAheadToKeep;\n    }\n\n    function setLastBitrateCachingInfo(enable, ttl) {\n        if (typeof enable !== 'boolean' || (ttl !== undefined && (typeof ttl !== 'number' || isNaN(ttl)))) {\n            throw Constants.BAD_ARGUMENT_ERROR;\n        }\n        lastBitrateCachingInfo.enabled = enable;\n        if (ttl !== undefined) {\n            lastBitrateCachingInfo.ttl = ttl;\n        }\n    }\n\n    function getLastBitrateCachingInfo() {\n        return lastBitrateCachingInfo;\n    }\n\n    function setLastMediaSettingsCachingInfo(enable, ttl) {\n        if (typeof enable !== 'boolean' || (ttl !== undefined && (typeof ttl !== 'number' || isNaN(ttl)))) {\n            throw Constants.BAD_ARGUMENT_ERROR;\n        }\n        lastMediaSettingsCachingInfo.enabled = enable;\n        if (ttl !== undefined) {\n            lastMediaSettingsCachingInfo.ttl = ttl;\n        }\n    }\n\n    function getLastMediaSettingsCachingInfo() {\n        return lastMediaSettingsCachingInfo;\n    }\n\n    function setBufferPruningInterval(value) {\n        checkParameterType(value, 'number');\n        bufferPruningInterval = value;\n    }\n\n    function getBufferPruningInterval() {\n        return bufferPruningInterval;\n    }\n\n    function setRetryAttemptsForType(type, value) {\n        if (typeof value !== 'number' || typeof type !== 'string' || (type !== HTTPRequest.MPD_TYPE && type !== HTTPRequest.MEDIA_SEGMENT_TYPE)) {\n            throw Constants.BAD_ARGUMENT_ERROR;\n        }\n        retryAttempts[type] = value;\n    }\n\n    function getRetryAttemptsForType(type) {\n        return getLowLatencyEnabled() ? retryAttempts[type] * LOW_LATENCY_MULTIPLY_FACTOR : retryAttempts[type];\n    }\n\n    function setRetryIntervalForType(type, value) {\n        checkParameterType(value, 'number');\n        retryIntervals[type] = value;\n    }\n\n    function getRetryIntervalForType(type) {\n        return getLowLatencyEnabled() ? retryIntervals[type] / LOW_LATENCY_REDUCTION_FACTOR : retryIntervals[type];\n    }\n\n    function setWallclockTimeUpdateInterval(value) {\n        checkParameterType(value, 'number');\n        wallclockTimeUpdateInterval = value;\n    }\n\n    function getWallclockTimeUpdateInterval() {\n        return wallclockTimeUpdateInterval;\n    }\n\n    function setScheduleWhilePaused(value) {\n        checkParameterType(value, 'boolean');\n        scheduleWhilePaused = value;\n    }\n\n    function getScheduleWhilePaused() {\n        return scheduleWhilePaused;\n    }\n\n    function setLiveDelayFragmentCount(value) {\n        checkParameterType(value, 'number');\n        liveDelayFragmentCount = value;\n    }\n\n    function getLiveDelayFragmentCount() {\n        return liveDelayFragmentCount;\n    }\n\n    function setLiveDelay(value) {\n        if (value !== undefined) { // undefined is the default value...\n            checkParameterType(value, 'number');\n        }\n        liveDelay = value;\n    }\n\n    function getLiveDelay() {\n        if (lowLatencyEnabled) {\n            return liveDelay || DEFAULT_LOW_LATENCY_LIVE_DELAY;\n        }\n        return liveDelay;\n    }\n\n    function setUseManifestDateHeaderTimeSource(value) {\n        checkParameterType(value, 'boolean');\n        useManifestDateHeaderTimeSource = value;\n    }\n\n    function getUseManifestDateHeaderTimeSource() {\n        return useManifestDateHeaderTimeSource;\n    }\n\n    function setUseSuggestedPresentationDelay(value) {\n        checkParameterType(value, 'boolean');\n        useSuggestedPresentationDelay = value;\n    }\n\n    function getUseSuggestedPresentationDelay() {\n        return useSuggestedPresentationDelay;\n    }\n\n    function addUTCTimingSource(schemeIdUri, value) {\n        removeUTCTimingSource(schemeIdUri, value); //check if it already exists and remove if so.\n        let vo = new UTCTiming();\n        vo.schemeIdUri = schemeIdUri;\n        vo.value = value;\n        UTCTimingSources.push(vo);\n    }\n\n    function getUTCTimingSources() {\n        return UTCTimingSources;\n    }\n\n    function removeUTCTimingSource(schemeIdUri, value) {\n        checkParameterType(schemeIdUri, 'string');\n        checkParameterType(value, 'string');\n        UTCTimingSources.forEach(function (obj, idx) {\n            if (obj.schemeIdUri === schemeIdUri && obj.value === value) {\n                UTCTimingSources.splice(idx, 1);\n            }\n        });\n    }\n\n    function clearDefaultUTCTimingSources() {\n        UTCTimingSources = [];\n    }\n\n    function restoreDefaultUTCTimingSources() {\n        addUTCTimingSource(DEFAULT_UTC_TIMING_SOURCE.scheme, DEFAULT_UTC_TIMING_SOURCE.value);\n    }\n\n    function setXHRWithCredentialsForType(type, value) {\n        if (!type) {\n            Object.keys(xhrWithCredentials).forEach(key => {\n                setXHRWithCredentialsForType(key, value);\n            });\n        } else {\n            xhrWithCredentials[type] = !!value;\n        }\n    }\n\n    function getXHRWithCredentialsForType(type) {\n        const useCreds = xhrWithCredentials[type];\n\n        return useCreds === undefined ? xhrWithCredentials.default : useCreds;\n    }\n\n    function getFastSwitchEnabled() {\n        return fastSwitchEnabled;\n    }\n\n    function setFastSwitchEnabled(value) {\n        checkParameterType(value, 'boolean');\n        fastSwitchEnabled = value;\n    }\n\n    function setMovingAverageMethod(value) {\n        if (value === Constants.MOVING_AVERAGE_SLIDING_WINDOW || value === Constants.MOVING_AVERAGE_EWMA) {\n            movingAverageMethod = value;\n        } else {\n            throw Constants.BAD_ARGUMENT_ERROR;\n        }\n    }\n\n    function getMovingAverageMethod() {\n        return movingAverageMethod;\n    }\n\n    function setJumpGaps(value) {\n        checkParameterType(value, 'boolean');\n        jumpGaps = value;\n    }\n\n    function getJumpGaps() {\n        return jumpGaps;\n    }\n\n    function setSmallGapLimit(value) {\n        checkParameterType(value, 'number');\n        smallGapLimit = value;\n    }\n\n    function getSmallGapLimit() {\n        return smallGapLimit;\n    }\n\n    function getLowLatencyEnabled() {\n        return lowLatencyEnabled;\n    }\n\n    function setLowLatencyEnabled(value) {\n        checkParameterType(value, 'boolean');\n        lowLatencyEnabled = value;\n    }\n\n    function setCatchUpPlaybackRate(value) {\n        checkParameterType(value, 'number');\n        checkRange(value, 0.0, 0.5);\n\n        liveCatchUpPlaybackRate = value;\n    }\n\n    function getCatchUpPlaybackRate() {\n        return liveCatchUpPlaybackRate;\n    }\n\n    function setLowLatencyMinDrift(value) {\n        checkParameterType(value, 'number');\n        liveCatchUpMinDrift = value;\n    }\n\n    function getLowLatencyMinDrift() {\n        return liveCatchUpMinDrift;\n    }\n\n    function setLowLatencyMaxDriftBeforeSeeking(value) {\n        checkParameterType(value, 'number');\n        liveCatchUpMaxDrift = value;\n    }\n\n    function getLowLatencyMaxDriftBeforeSeeking() {\n        return liveCatchUpMaxDrift;\n    }\n\n    function setManifestUpdateRetryInterval(value) {\n        checkParameterType(value, 'number');\n        manifestUpdateRetryInterval = value;\n    }\n\n    function getManifestUpdateRetryInterval() {\n        return manifestUpdateRetryInterval;\n    }\n\n    function setKeepProtectionMediaKeys(value) {\n        checkParameterType(value, 'boolean');\n        keepProtectionMediaKeys = value;\n    }\n\n    function getKeepProtectionMediaKeys() {\n        return keepProtectionMediaKeys;\n    }\n\n    function getDefaultUtcTimingSource() {\n        return DEFAULT_UTC_TIMING_SOURCE;\n    }\n\n    function reset() {\n        //TODO need to figure out what props to persist across sessions and which to reset if any.\n        //setup();\n    }\n\n    instance = {\n        setABRStrategy: setABRStrategy,\n        getABRStrategy: getABRStrategy,\n        setUseDefaultABRRules: setUseDefaultABRRules,\n        getUseDefaultABRRules: getUseDefaultABRRules,\n        getABRCustomRules: getABRCustomRules,\n        addABRCustomRule: addABRCustomRule,\n        removeABRCustomRule: removeABRCustomRule,\n        setBandwidthSafetyFactor: setBandwidthSafetyFactor,\n        getBandwidthSafetyFactor: getBandwidthSafetyFactor,\n        setAbandonLoadTimeout: setAbandonLoadTimeout,\n        getAbandonLoadTimeout: getAbandonLoadTimeout,\n        setLastBitrateCachingInfo: setLastBitrateCachingInfo,\n        getLastBitrateCachingInfo: getLastBitrateCachingInfo,\n        setLastMediaSettingsCachingInfo: setLastMediaSettingsCachingInfo,\n        getLastMediaSettingsCachingInfo: getLastMediaSettingsCachingInfo,\n        setStableBufferTime: setStableBufferTime,\n        getStableBufferTime: getStableBufferTime,\n        setBufferTimeAtTopQuality: setBufferTimeAtTopQuality,\n        getBufferTimeAtTopQuality: getBufferTimeAtTopQuality,\n        setBufferTimeAtTopQualityLongForm: setBufferTimeAtTopQualityLongForm,\n        getBufferTimeAtTopQualityLongForm: getBufferTimeAtTopQualityLongForm,\n        setLongFormContentDurationThreshold: setLongFormContentDurationThreshold,\n        getLongFormContentDurationThreshold: getLongFormContentDurationThreshold,\n        setSegmentOverlapToleranceTime: setSegmentOverlapToleranceTime,\n        getSegmentOverlapToleranceTime: getSegmentOverlapToleranceTime,\n        getCacheLoadThresholdForType: getCacheLoadThresholdForType,\n        setCacheLoadThresholdForType: setCacheLoadThresholdForType,\n        setBufferToKeep: setBufferToKeep,\n        getBufferToKeep: getBufferToKeep,\n        setBufferAheadToKeep: setBufferAheadToKeep,\n        getBufferAheadToKeep: getBufferAheadToKeep,\n        setBufferPruningInterval: setBufferPruningInterval,\n        getBufferPruningInterval: getBufferPruningInterval,\n        setRetryAttemptsForType: setRetryAttemptsForType,\n        getRetryAttemptsForType: getRetryAttemptsForType,\n        setRetryIntervalForType: setRetryIntervalForType,\n        getRetryIntervalForType: getRetryIntervalForType,\n        setWallclockTimeUpdateInterval: setWallclockTimeUpdateInterval,\n        getWallclockTimeUpdateInterval: getWallclockTimeUpdateInterval,\n        setScheduleWhilePaused: setScheduleWhilePaused,\n        getScheduleWhilePaused: getScheduleWhilePaused,\n        getUseSuggestedPresentationDelay: getUseSuggestedPresentationDelay,\n        setUseSuggestedPresentationDelay: setUseSuggestedPresentationDelay,\n        setLiveDelayFragmentCount: setLiveDelayFragmentCount,\n        getLiveDelayFragmentCount: getLiveDelayFragmentCount,\n        getLiveDelay: getLiveDelay,\n        setLiveDelay: setLiveDelay,\n        setUseManifestDateHeaderTimeSource: setUseManifestDateHeaderTimeSource,\n        getUseManifestDateHeaderTimeSource: getUseManifestDateHeaderTimeSource,\n        addUTCTimingSource: addUTCTimingSource,\n        removeUTCTimingSource: removeUTCTimingSource,\n        getUTCTimingSources: getUTCTimingSources,\n        clearDefaultUTCTimingSources: clearDefaultUTCTimingSources,\n        restoreDefaultUTCTimingSources: restoreDefaultUTCTimingSources,\n        setXHRWithCredentialsForType: setXHRWithCredentialsForType,\n        getXHRWithCredentialsForType: getXHRWithCredentialsForType,\n        setFastSwitchEnabled: setFastSwitchEnabled,\n        getFastSwitchEnabled: getFastSwitchEnabled,\n        setMovingAverageMethod: setMovingAverageMethod,\n        getMovingAverageMethod: getMovingAverageMethod,\n        setJumpGaps: setJumpGaps,\n        getJumpGaps: getJumpGaps,\n        setSmallGapLimit: setSmallGapLimit,\n        getSmallGapLimit: getSmallGapLimit,\n        getLowLatencyEnabled: getLowLatencyEnabled,\n        setLowLatencyEnabled: setLowLatencyEnabled,\n        setCatchUpPlaybackRate: setCatchUpPlaybackRate,\n        getCatchUpPlaybackRate: getCatchUpPlaybackRate,\n        setLowLatencyMinDrift: setLowLatencyMinDrift,\n        getLowLatencyMinDrift: getLowLatencyMinDrift,\n        setLowLatencyMaxDriftBeforeSeeking: setLowLatencyMaxDriftBeforeSeeking,\n        getLowLatencyMaxDriftBeforeSeeking: getLowLatencyMaxDriftBeforeSeeking,\n        setManifestUpdateRetryInterval: setManifestUpdateRetryInterval,\n        getManifestUpdateRetryInterval: getManifestUpdateRetryInterval,\n        setKeepProtectionMediaKeys: setKeepProtectionMediaKeys,\n        getKeepProtectionMediaKeys: getKeepProtectionMediaKeys,\n        getDefaultUtcTimingSource: getDefaultUtcTimingSource,\n        reset: reset\n    };\n\n    setup();\n\n    return instance;\n}\n\n//TODO see if you can move this and not export and just getter to get default value.\nMediaPlayerModel.__dashjs_factory_name = 'MediaPlayerModel';\nexport default FactoryMaker.getSingletonFactory(MediaPlayerModel);"]}